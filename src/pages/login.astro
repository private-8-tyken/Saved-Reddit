---
// src/pages/login.astro
// Simple passcode-protected login page (client-side only).
// IMPORTANT: This is obfuscation, not security. Do not ship sensitive data.
import BaseLayout from "../layouts/BaseLayout.astro";

// Normalize base (matches what we did in BaseLayout/Header)
const BASE = import.meta.env.BASE_URL || "/";

// NOTE: Client-side gate only (obfuscation, not real security)
const PASSCODE = "changeme"; // <-- update this
---

<BaseLayout title="Login" requiresAuth={false}>
    <div class="container">
        <h2>Enter passcode</h2>
        <form id="loginForm" class="row" style="max-width:560px; gap:8px;">
            <input
                class="input"
                id="pass"
                type="password"
                placeholder="Passcode"
                style="flex:1"
            />
            <button class="button primary" type="submit">Enter</button>
        </form>
        <div id="err" class="meta" style="color:#f79b9b; margin-top:8px;"></div>
    </div>

    <!-- Pass values safely via data-* attributes -->
    <script is:inline data-base={BASE} data-pass={PASSCODE}>
        (function () {
            try {
                var me = document.currentScript;
                var BASE = (me && me.dataset && me.dataset.base) || "/";
                // Ensure trailing slash
                BASE = BASE.endsWith("/") ? BASE : BASE + "/";
                var PASS = (me && me.dataset && me.dataset.pass) || "";

                var form = document.getElementById("loginForm");
                var input = document.getElementById("pass");
                var err = document.getElementById("err");

                form?.addEventListener("submit", function (e) {
                    e.preventDefault();
                    var v = (input?.value || "").trim();
                    if (v === PASS) {
                        try {
                            sessionStorage.setItem("authed", "1");
                        } catch (_) {}
                        location.replace(BASE); // go to site root
                    } else {
                        if (err) err.textContent = "Incorrect passcode.";
                    }
                });
            } catch (_) {}
        })();
    </script>
</BaseLayout>
