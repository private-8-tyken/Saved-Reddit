---
import "../styles/login.css";
import { BASE } from "../lib/base";
const title = "Sign in";
---

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>{title}</title>

        <!-- already logged in? bounce before rendering -->
        <script is:inline>
            const __b = "/Saved-Reddit/";
            if (
                sessionStorage.getItem("site_authed") === "1" ||
                localStorage.getItem("site_authed") === "1"
            ) {
                location.replace(__b);
            }
        </script>
    </head>
    <body>
        <main>
            <h1 style="margin:0 0 .5rem;">Enter Password</h1>
            <p id="err" class="err">Incorrect password. Try again.</p>
            <form id="login">
                <label for="pw">Password</label>
                <input
                    id="pw"
                    type="password"
                    placeholder="••••••••"
                    required
                />
                <div class="row">
                    <input id="remember" type="checkbox" />
                    <label for="remember" style="display:inline;"
                        >Remember me on this device</label
                    >
                </div>
                <button type="submit">Unlock</button>
            </form>
        </main>

        <script is:inline>
            // submit handler
            const PASSWORD = "changeme123";

            const form = document.getElementById("login");
            const err = document.getElementById("err");

            form.addEventListener("submit", (e) => {
                e.preventDefault();
                err.style.display = "none";

                const ok = document.getElementById("pw").value === PASSWORD;
                if (!ok) {
                    err.style.display = "block";
                    return;
                }

                const remember = document.getElementById("remember").checked;

                // ✅ define __b in THIS script too (scripts don’t share scope)
                const __b = "/Saved-Reddit/";

                (remember ? localStorage : sessionStorage).setItem(
                    "site_authed",
                    "1",
                );
                location.replace(__b); // ✅ no '${base}' here
            });
        </script>
    </body>
</html>
