---
import "../styles/index.css";
import { BASE } from "../lib/base";
import RedditFeed from "../components/RedditFeed.jsx";
const title = "Saved Reddit Feed";
const desc =
    "Browse and search your saved Reddit posts with filters, previews, and detail pages.";
---

<html lang="en">
    <head>
        <script is:inline>
            const __b = "/Saved-Reddit/";
            if (
                sessionStorage.getItem("site_authed") !== "1" &&
                localStorage.getItem("site_authed") !== "1"
            ) {
                location.replace(__b + "login");
            }
        </script>

        <meta charset="utf-8" />
        <link rel="icon" type="image/svg+xml" href={`${BASE}favicon.svg`} />
        <meta name="viewport" content="width=device-width" />
        <title>{title}</title>
        <meta name="description" content={desc} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={desc} />
        <meta property="og:type" content="website" />
        <meta property="og:image" content={`${BASE}og.png`} />
        <meta name="twitter:card" content="summary_large_image" />

        <!-- Small inline helpers: theme toggle, copy link, j/k nav -->
        <script is:inline>
            (function () {
                const KEY = "theme";
                const mql = window.matchMedia("(prefers-color-scheme: dark)");
                const apply = (pref) => {
                    const mode =
                        pref === "system"
                            ? mql.matches
                                ? "dark"
                                : "light"
                            : pref;
                    document.documentElement.dataset.theme = mode;
                    localStorage.setItem(KEY, pref);
                };
                const init = () => {
                    apply(localStorage.getItem(KEY) || "system");
                    mql.addEventListener("change", () => {
                        if (
                            (localStorage.getItem(KEY) || "system") === "system"
                        )
                            apply("system");
                    });
                };
                window.addEventListener("DOMContentLoaded", () => {
                    init();
                    const sel = document.getElementById("themeSelect");
                    if (sel) {
                        sel.value = localStorage.getItem(KEY) || "system";
                        sel.onchange = () => apply(sel.value);
                    }
                    const cl = document.getElementById("copyLink");
                    if (cl)
                        cl.onclick = async () => {
                            try {
                                await navigator.clipboard.writeText(
                                    location.href,
                                );
                                cl.textContent = "Copied!";
                                setTimeout(
                                    () => (cl.textContent = "Copy link"),
                                    1000,
                                );
                            } catch {}
                        };
                    // j/k quick navigation
                    document.addEventListener("keydown", (e) => {
                        if (
                            ["INPUT", "TEXTAREA", "SELECT"].includes(
                                document.activeElement.tagName,
                            )
                        )
                            return;
                        const cards = Array.from(
                            document.querySelectorAll(".post-card"),
                        );
                        if (!cards.length) return;
                        const y = scrollY + 1;
                        const idx = cards.findIndex(
                            (el) =>
                                el.getBoundingClientRect().top + scrollY >
                                y - 10,
                        );
                        if (e.key === "j")
                            cards[
                                Math.min(idx === -1 ? 0 : idx, cards.length - 1)
                            ].scrollIntoView({
                                behavior: "smooth",
                                block: "start",
                            });
                        else if (e.key === "k")
                            cards[Math.max(idx - 2, 0)].scrollIntoView({
                                behavior: "smooth",
                                block: "start",
                            });
                    });
                });
            })();
        </script>
    </head>
    <body>
        <header>
            <h1 style="margin:0;">Saved Reddit Feed</h1>
            <div style="display:flex;gap:8px;align-items:center">
                <button id="copyLink" class="btn" type="button"
                    >Copy link</button
                >
                <label class="muted">Theme</label>
                <select id="themeSelect" class="btn">
                    <option value="system">System</option>
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                </select>
            </div>
        </header>
        <RedditFeed client:only="react" />
    </body>
</html>
