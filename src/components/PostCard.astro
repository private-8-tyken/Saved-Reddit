---
import PostMeta from './PostMeta.astro';
import LinkPreview from './LinkPreview.astro';
const { p } = Astro.props as any;
const permalink = `/post/${p.id}`;
---
<article class="border border-white/10 rounded-lg p-4 bg-white/5 hover:bg-white/10 transition">
  <a href={permalink} class="block text-base font-medium mb-1">{p.title}</a>
  <PostMeta p={p} />
  {p.selftext && (
    <p class="mt-2 text-sm text-[#c9d1d9] line-clamp-4 whitespace-pre-wrap">{p.selftext}</p>
  )}
  {/* Media policy: show LINK previews only; no embedded media yet */}
  {p.link_domain && p.url && (
    <div class="mt-3"><LinkPreview domain={p.link_domain} url={p.url} title={p.title} /></div>
  )}
  <div class="mt-3 text-xs flex gap-3 text-[#8a8f95]">
    {p.over_18 && <span class="px-1.5 py-0.5 rounded bg-red-500/20 text-red-300">NSFW</span>}
    {p.spoiler && <span class="px-1.5 py-0.5 rounded bg-yellow-500/20 text-yellow-200">Spoiler</span>}
  </div>
</article>