
---

---
import { useEffect, useState } from 'react';
---

<script>
  const [posts, setPosts] = useState([]);
  useEffect(() => {
    fetch(`${base}data/indexes/posts-manifest.json')
      .then(r => r.json())
      .then(setPosts);
  }, []);
</script>

<div class="feed">
  {posts.length === 0 ? (
    <div>Loading...</div>
  ) : (
    posts.map((post) => (
      <article class="post-card">
        <h2>{post.title}</h2>
        <div class="meta">
          <span>r/{post.subreddit}</span>
          <span>by {post.author}</span>
          <span>Score: {post.score}</span>
          <span>Comments: {post.num_comments}</span>
        </div>
        {post.flair && <span class="flair">{post.flair}</span>}
        {post.over_18 && <span class="nsfw">NSFW</span>}
        {post.spoiler && <span class="spoiler">Spoiler</span>}
      </article>
    ))
  )}
</div>

<style>
.feed {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  max-width: 700px;
  margin: 2rem auto;
}
.post-card {
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 1rem;
  background: var(--astro-bg, #fff);
}
.meta {
  font-size: 0.9em;
  color: #666;
  display: flex;
  gap: 1.5em;
  margin-bottom: 0.5em;
}
.flair {
  background: #eee;
  color: #333;
  border-radius: 4px;
  padding: 0.1em 0.5em;
  margin-left: 0.5em;
}
.nsfw {
  background: #f66;
  color: #fff;
  border-radius: 4px;
  padding: 0.1em 0.5em;
  margin-left: 0.5em;
}
.spoiler {
  background: #333;
  color: #fff;
  border-radius: 4px;
  padding: 0.1em 0.5em;
  margin-left: 0.5em;
}
</style>
