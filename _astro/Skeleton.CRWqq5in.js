import{j as f}from"./jsx-runtime.D_zvdyIk.js";import"./index.RH_Wq4ov.js";const x="sr__v2__favorites",E=typeof window<"u",O=E&&typeof window.localStorage<"u";let u=null;function D(){try{typeof window<"u"&&window.dispatchEvent(new Event("favorites:changed"))}catch{}}function F(e,t){try{return JSON.parse(e)}catch{return t}}function b(){if(!O)return{};if(u)return u;const e=window.localStorage.getItem(x),t=F(e,{});if(!t||typeof t!="object")return u={},u;for(const o of Object.keys(t)){const n=t[o];(!n||typeof n.ts!="number")&&delete t[o]}return u=t,u}function V(e){if(O){u=e||{};try{window.localStorage.setItem(x,JSON.stringify(u))}catch{}D()}}function k(){const e=b();return new Map(Object.entries(e))}function L(){return new Set(Object.keys(b()))}function M(e){const t=new Set(e||[]),o={...b()};for(const n of Object.keys(o))t.has(n)||delete o[n];for(const n of t)o[n]||(o[n]={ts:Date.now()});V(o)}function C(){const e=[["id","timestamp"]];for(const[n,s]of k().entries()){const d=new Date(s.ts||Date.now()).toISOString();e.push([n,d])}const t=n=>{const s=String(n??"");return/[",\n]/.test(s)?`"${s.replace(/"/g,'""')}"`:s};return e.map(n=>n.map(t).join(",")).join(`
`)}function R(e){let t=0,o=0,n=0;if(typeof e!="string"||!e.trim())return{added:t,alreadyHad:o,invalid:n};function s(a){const w=[];let i=0,r="",c=[],j=!1;for(;i<a.length;){const l=a[i++];j?l==='"'?a[i]==='"'?(r+='"',i++):j=!1:r+=l:l==='"'?j=!0:l===","?(c.push(r),r=""):l===`
`||l==="\r"?(l==="\r"&&a[i]===`
`&&i++,c.push(r),r="",(c.length>1||c[0]!=="")&&w.push(c),c=[]):r+=l}return(r.length||c.length)&&(c.push(r),w.push(c)),w}const d=s(e).filter(a=>a.length>0);if(!d.length)return{added:t,alreadyHad:o,invalid:n};const m=d[0].map(a=>String(a||"").trim().toLowerCase());let h=0,p=0,S=1;m.includes("id")&&(p=m.indexOf("id"),S=m.indexOf("timestamp"),h=1);const y={...b()};for(let a=h;a<d.length;a++){const w=d[a],i=String(w[p]||"").trim();if(!i){n++;continue}let r=Date.now();if(S>=0&&w[S]){const c=new Date(String(w[S]).trim());isNaN(c.getTime())||(r=c.getTime())}y[i]?((typeof y[i].ts!="number"||r<y[i].ts)&&(y[i].ts=r),o++):(y[i]={ts:r},t++)}return V(y),{added:t,alreadyHad:o,invalid:n}}const v="sr_viewed_v2",J=14;function I(){return Date.now()}function A(e){return e*24*60*60*1e3}function _(){try{const e=localStorage.getItem(v);if(!e)return{v:2,byId:{}};const t=JSON.parse(e);if(t&&t.v===2&&t.byId&&typeof t.byId=="object")return t}catch{}try{const e=localStorage.getItem("sr_viewed")||localStorage.getItem("viewedPosts");if(e){const t=JSON.parse(e);if(Array.isArray(t)){const n={v:2,byId:Object.fromEntries(t.map(s=>[s,I()]))};return localStorage.setItem(v,JSON.stringify(n)),n}}}catch{}return{v:2,byId:{}}}function N(e){try{localStorage.setItem(v,JSON.stringify(e))}catch{}}function P(e){if(!e)return;const t=_();t.byId[e]=I(),N(t)}function W({ttlDays:e=J}={}){const t=A(e),o=_(),n=new Set,s=o.byId||{},d=I();let m=!1;for(const[h,p]of Object.entries(s))typeof p!="number"||d-p>t?(delete s[h],m=!0):n.add(h);return m&&N({v:2,byId:s}),n}typeof window<"u"&&(window.SR=window.SR||{},window.SR.exportFavoritesCSV=C,window.SR.importFavoritesCSV=R);function g({h:e=16,w:t="100%",style:o={}}){return f.jsx("div",{className:"skeleton",style:{height:e,width:t,...o},"aria-hidden":"true"})}function Y(){return f.jsxs("div",{className:"card",style:{marginBottom:12},"aria-busy":"true",children:[f.jsx(g,{h:180,style:{marginBottom:8}}),f.jsx(g,{h:18,w:"80%",style:{margin:"6px 0"}}),f.jsx(g,{h:14,w:"40%"})]})}function K(){return f.jsx("div",{className:"container",children:f.jsxs("div",{className:"card",style:{marginBottom:12},"aria-busy":"true",children:[f.jsx(g,{h:28,w:"70%",style:{margin:"6px 0"}}),f.jsx(g,{h:14,w:"40%",style:{marginBottom:8}}),f.jsx(g,{h:220})]})})}export{K as P,Y as S,W as g,L as l,P as m,M as s};
