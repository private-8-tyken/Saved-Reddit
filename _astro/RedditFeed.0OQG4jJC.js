import{B as _,j as e,a as R}from"./base.LUk68UGw.js";import{r as m}from"./index.RH_Wq4ov.js";function T({label:a,value:s=[],onChange:r,loadPath:o}){const[i,c]=m.useState(!1),[h,p]=m.useState(null),[f,n]=m.useState(""),[l,w]=m.useState("freq"),x=40,g=360;m.useEffect(()=>{i&&!h&&fetch(`${_}${o}`).then(u=>u.json()).then(p).catch(()=>p([]))},[i,h]);const d=m.useMemo(()=>{let u=h||[];if(f){const j=f.toLowerCase();u=u.filter(y=>y.name.toLowerCase().includes(j))}return l==="az"&&(u=u.slice().sort((j,y)=>j.name.localeCompare(y.name))),u},[h,f,l]),[t,b]=m.useState(0),v=Math.max(0,Math.floor(t/x)-4),N=Math.min(d.length,v+Math.ceil(g/x)+8),k=v*x,L=Math.max(0,(d.length-N)*x),S=u=>{const j=new Set(s);j.has(u)?j.delete(u):j.add(u),r(Array.from(j).sort())};return e.jsxs("div",{className:"lms",children:[e.jsx("div",{className:"label",children:a}),e.jsx("button",{type:"button",className:"picker",onClick:()=>c(!0),children:s.length?`${s.length} selected`:"Browse allâ€¦"}),i&&e.jsx("div",{className:"lms-backdrop",onClick:()=>c(!1)}),i&&e.jsxs("div",{className:"lms-modal",role:"dialog","aria-modal":"true","aria-label":a,children:[e.jsxs("div",{className:"lms-head",children:[e.jsx("strong",{children:a}),e.jsx("div",{className:"lms-spacer"}),e.jsx("button",{className:"pill",onClick:()=>w(l==="freq"?"az":"freq"),title:l==="freq"?"Sort Aâ†’Z":"Sort by frequency",children:l==="freq"?"Aâ†’Z":"Freq"}),e.jsx("button",{className:"pill",onClick:()=>c(!1),children:"Done"})]}),!!s.length&&e.jsx("div",{className:"lms-selected",children:s.map(u=>e.jsxs("button",{className:"tag",onClick:()=>S(u),title:"Remove",children:[u," âœ•"]},u))}),e.jsx("input",{className:"lms-search",placeholder:`Search ${a.toLowerCase()}â€¦`,value:f,onChange:u=>n(u.target.value)}),e.jsxs("div",{className:"lms-list",style:{height:g,overflowY:"auto"},onScroll:u=>b(u.currentTarget.scrollTop),children:[e.jsx("div",{style:{height:k}}),d.slice(v,N).map(u=>e.jsxs("label",{className:"lms-row",style:{height:x},children:[e.jsx("input",{type:"checkbox",checked:s.includes(u.name),onChange:()=>S(u.name)}),e.jsx("span",{className:"name",children:u.name}),typeof u.count=="number"&&e.jsx("span",{className:"count",children:u.count})]},u.name)),e.jsx("div",{style:{height:L}})]})]}),e.jsx("style",{children:`
        .picker { background:#2a2b2c; border:1px solid #343536; color:#d7dadc; border-radius:6px; padding:6px 10px; cursor:pointer; }
        .lms-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:70; }
        .lms-modal { position:fixed; top:8vh; left:50%; transform:translateX(-50%);
          width:min(92vw, 560px); max-height:84vh; background:#1a1a1b; border:1px solid #343536; border-radius:8px; padding:12px;
          display:flex; flex-direction:column; gap:8px; z-index:71; }
        .lms-head { display:flex; align-items:center; gap:8px; }
        .lms-spacer { flex:1; }
        .pill { background:#2a2b2c; border:1px solid #343536; color:#d7dadc; border-radius:999px; padding:4px 10px; cursor:pointer; font-size:12px; }
        .lms-selected { display:flex; flex-wrap:wrap; gap:6px; }
        .tag { background:#3b3c3d; border:1px solid #4a4c4f; color:#d7dadc; border-radius:999px; padding:2px 8px; font-size:12px; cursor:pointer; }
        .lms-search { width:100%; background:#0f1a1c; color:#d7dadc; border:1px solid #343536; border-radius:6px; padding:8px; }
        .lms-list { border:1px solid #343536; border-radius:6px; background:#0f1a1c; }
        .lms-row { display:flex; align-items:center; gap:8px; padding:0 10px; border-bottom:1px solid rgba(255,255,255,.05); }
        .name { flex:1; }
        .count { color:#818384; font-size:12px; }
        @media (max-width: 900px) {
          .lms-modal { top:0; bottom:0; left:auto; right:0; transform:none; width:min(92vw, 420px); max-height:100dvh; border-left:1px solid #343536; border-radius:0; }
        }
      `})]})}function C({facets:a,query:s,onChange:r}){const o=(c,h)=>{const p=new Set(s[c]||[]);p.has(h)?p.delete(h):p.add(h),r({...s,[c]:Array.from(p).sort(),page:1})},i=(c,h,p)=>e.jsxs("div",{className:"block",children:[e.jsx("div",{className:"label",children:c}),e.jsx("div",{className:"chips",children:p.map(f=>e.jsx("button",{className:`chip ${s[h]?.includes(f)?"on":""}`,onClick:()=>o(h,f),type:"button",children:f},f))})]});return(s.sort||"").endsWith("_desc"),e.jsxs("aside",{className:"filters",children:[e.jsx("div",{className:"row",children:e.jsx("input",{className:"search",type:"search",placeholder:"Search title & textâ€¦",value:s.q||"",onChange:c=>r({...s,q:c.target.value,page:1})})}),e.jsxs("div",{className:"row two",children:[e.jsxs("label",{children:["From",e.jsx("input",{type:"date",value:s.from||"",onChange:c=>r({...s,from:c.target.value,page:1})})]}),e.jsxs("label",{children:["To",e.jsx("input",{type:"date",value:s.to||"",onChange:c=>r({...s,to:c.target.value,page:1})})]})]}),e.jsx("div",{className:"row",children:e.jsxs("label",{children:["Sort",e.jsxs("div",{className:"sort-row",children:[e.jsx("div",{className:"seg",children:[["saved","Save Order"],["created","Created"],["score","Score"],["comments","Comments"],["title","Title"]].map(([c,h])=>{const p=(s.sort||"").endsWith("_asc")?"asc":"desc",f=(s.sort||"saved_asc").startsWith(c+"_");return e.jsx("button",{type:"button",className:`seg-btn ${f?"on":""}`,onClick:()=>r({...s,sort:`${c}_${p}`,page:1}),"aria-pressed":f,children:h},c)})}),e.jsx("button",{type:"button",className:"dir",onClick:()=>{const c=s.sort||"saved_asc",h=c.endsWith("_desc")?c.replace("_desc","_asc"):c.replace("_asc","_desc");r({...s,sort:h,page:1})},title:s.sort?.endsWith("_desc")?"Descending":"Ascending",children:s.sort?.endsWith("_desc")?"â†“":"â†‘"})]})]})}),i("Media","media",a.mediaTypes||[]),i("Domain","domain",a.domains||[]),e.jsx(T,{label:"Subreddit",value:s.sub,onChange:c=>r({...s,sub:c,page:1}),loadPath:"data/indexes/subs-all.json"}),e.jsx(T,{label:"Author",value:s.author,onChange:c=>r({...s,author:c,page:1}),loadPath:"data/indexes/authors-all.json"}),i("Flair","flair",a.flairs||[]),e.jsx("div",{className:"row actions",children:e.jsx("button",{type:"button",onClick:()=>r({q:"",sub:[],author:[],flair:[],domain:[],media:[],from:"",to:"",sort:"saved_asc",page:1}),children:"Clear all"})})]})}function F({open:a,onClose:s,children:r}){m.useEffect(()=>(document.body.style.overflow=a?"hidden":"",()=>document.body.style.overflow=""),[a]),m.useEffect(()=>{if(!a)return;const d=t=>t.key==="Escape"&&s();return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[a,s]);const o=m.useRef({x:null,y:null}),i=m.useRef(!1),c=m.useCallback((d,t)=>{o.current={x:d,y:t},i.current=!0},[]),h=m.useCallback((d,t)=>{if(!i.current||o.current.x==null)return;const b=d-o.current.x,v=t-o.current.y;Math.abs(b)<10||Math.abs(v)>Math.abs(b)||b>60&&(i.current=!1,s())},[s]),p=m.useCallback(()=>{i.current=!1,o.current={x:null,y:null}},[]),f=d=>c(d.touches[0].clientX,d.touches[0].clientY),n=d=>h(d.touches[0].clientX,d.touches[0].clientY),l=p,w=d=>d.pointerType==="mouse"&&c(d.clientX,d.clientY),x=d=>d.pointerType==="mouse"&&h(d.clientX,d.clientY),g=d=>d.pointerType==="mouse"&&p();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mdrawer-backdrop",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",opacity:a?1:0,pointerEvents:a?"auto":"none",transition:"opacity .15s ease",zIndex:50},onClick:s}),e.jsxs("aside",{className:"mdrawer",style:{position:"fixed",top:0,right:0,height:"100dvh",width:"min(92vw, 420px)",borderLeft:"1px solid #343536",transform:a?"translateX(0)":"translateX(100%)",transition:"transform .2s ease",zIndex:51,padding:12,overflowY:"auto",background:"rgba(26, 26, 27, 0.5)",touchAction:"pan-y"},role:"dialog","aria-modal":"true",onTouchStart:f,onTouchMove:n,onTouchEnd:l,onPointerDown:w,onPointerMove:x,onPointerUp:g,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("h3",{style:{margin:0,fontSize:16},children:"Filters"}),e.jsx("button",{type:"button",onClick:s,style:{background:"#2a2b2c",border:"1px solid #343536",color:"#d7dadc",borderRadius:6,padding:"6px 10px",cursor:"pointer"},children:"Close"})]}),r]})]})}const M=new Set(["sub","author","flair","domain","media"]),D=new Set(["saved_asc, created_desc","score_desc","comments_desc","title_asc"]),A={q:"",sub:[],author:[],flair:[],domain:[],media:[],from:"",to:"",sort:"saved_asc",page:1};function $(a=globalThis.location?.search||""){const s={...A},r=new URLSearchParams(a);for(const[o,i]of r.entries())M.has(o)?s[o]=i?i.split(",").filter(Boolean):[]:o==="page"?s.page=Math.max(1,parseInt(i||"1",10)):s[o]=i||"";return D.has(s.sort)||(s.sort="saved_asc"),s}function I(a){const s=new URLSearchParams;a.q&&s.set("q",a.q);for(const o of M)a[o]?.length&&s.set(o,a[o].join(","));a.from&&s.set("from",a.from),a.to&&s.set("to",a.to),a.sort&&a.sort!=="saved_asc"&&s.set("sort",a.sort),a.page&&a.page!==1&&s.set("page",String(a.page));const r=s.toString();return r?`?${r}`:""}function z(a,s=!1){const r=I(a),o=`${location.pathname}${r}`;s?history.replaceState(null,"",o):history.pushState(null,"",o)}function P(a,s){let r=a.slice();const o=(n,l)=>!l?.length||n&&l.includes(n),i=n=>n?Math.floor(new Date(n).getTime()/1e3):null;r=r.filter(n=>o(n.subreddit,s.sub)&&o(n.author,s.author)&&o(n.flair,s.flair)&&o(n.link_domain,s.domain)&&o(n.media_type,s.media));const c=i(s.from),h=i(s.to);c&&(r=r.filter(n=>(n.created_utc??0)>=c)),h&&(r=r.filter(n=>(n.created_utc??0)<=h));const p=(s.q||"").trim().toLowerCase();switch(p&&(r=r.filter(n=>(n.title||"").toLowerCase().includes(p)||(n.selftext_preview||"").toLowerCase().includes(p))),s.sort||"saved_asc"){case"saved_asc":default:r.sort((n,l)=>(n.saved_utc??0)-(l.saved_utc??0));break;case"saved_desc":r.sort((n,l)=>(l.saved_utc??0)-(n.saved_utc??0));break;case"created_asc":r.sort((n,l)=>(n.created_utc??0)-(l.created_utc??0));break;case"created_desc":r.sort((n,l)=>(l.created_utc??0)-(n.created_utc??0));break;case"score_desc":r.sort((n,l)=>(l.score??0)-(n.score??0));break;case"score_asc":r.sort((n,l)=>(n.score??0)-(l.score??0));break;case"comments_desc":r.sort((n,l)=>(l.num_comments??0)-(n.num_comments??0));break;case"comments_asc":r.sort((n,l)=>(n.num_comments??0)-(l.num_comments??0));break;case"title_asc":r.sort((n,l)=>(n.title||"").localeCompare(l.title||""));break;case"title_desc":r.sort((n,l)=>(l.title||"").localeCompare(n.title||""));break}return r}function O(a){return a?new Date(a*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}function Y(a){if(!a)return null;try{const s=a.split("/").filter(Boolean),r=s.findIndex(o=>o==="comments");if(r!==-1&&s[r+1]){const o=s[r+1];return o.startsWith("t3_")?o:`t3_${o}`}}catch{}return null}function E(a,s){if(!s||!a)return a;const r=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=new RegExp(`(${r})`,"gi");return a.split(o).map((i,c)=>o.test(i)?e.jsx("mark",{children:i},c):i)}function X(){const[a,s]=m.useState([]),[r,o]=m.useState(null),[i,c]=m.useState($()),[h,p]=m.useState(!1),[f,n]=m.useState(30);m.useEffect(()=>{fetch(`${_}data/indexes/posts-manifest.json`).then(t=>t.json()).then(s).catch(t=>console.error("Failed to load manifest",t))},[]),m.useEffect(()=>{fetch(`${_}data/indexes/facets.json`).then(t=>t.json()).then(o).catch(t=>console.error("Failed to load facets",t))},[]),m.useEffect(()=>{const t=()=>c($(location.search));return window.addEventListener("popstate",t),()=>window.removeEventListener("popstate",t)},[]);const l=t=>{c(t),z(t)},w=m.useMemo(()=>P(a,i),[a,i]),x=w.length,g=m.useRef(null),d=m.useRef(!1);return m.useEffect(()=>{n(30)},[i]),m.useEffect(()=>{if(!g.current)return;const t=g.current,b=new IntersectionObserver(v=>{v[0].isIntersecting&&(d.current||(d.current=!0,n(k=>k>=x?k:Math.min(k+30,x)),setTimeout(()=>d.current=!1,150)))},{root:null,rootMargin:"400px 0px",threshold:0});return b.observe(t),()=>b.disconnect()},[x,i]),a.length?e.jsxs("div",{className:"feed grid",children:[e.jsx("div",{className:"left",children:r&&e.jsx(C,{facets:r,query:i,onChange:l})}),e.jsxs("div",{className:"right",children:[e.jsx("div",{className:"mobile-bar",children:e.jsx("button",{className:"btn",type:"button",onClick:()=>p(!0),children:"Filters"})}),e.jsxs("div",{className:"resultbar",children:[e.jsxs("span",{children:[x," result",x===1?"":"s"]}),i.q&&e.jsxs("span",{className:"meta",children:[" â€¢ searching â€œ",i.q,"â€"]})]}),(x?w.slice(0,f):[]).map(t=>{const b=t.id||Y(t.permalink);return b?e.jsxs("article",{className:"post-card",children:[e.jsxs("div",{className:"topline",children:[e.jsxs("a",{className:"subreddit",href:`https://www.reddit.com/r/${t.subreddit}`,target:"_blank",rel:"noreferrer noopener",children:["r/",t.subreddit]}),e.jsx("span",{className:"dot",children:"â€¢"}),e.jsxs("span",{className:"by",children:["Posted by ",e.jsxs("span",{className:"author",children:["u/",t.author]})]}),t.created_utc&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"dot",children:"â€¢"}),e.jsx("time",{dateTime:new Date(t.created_utc*1e3).toISOString(),children:O(t.created_utc)})]})]}),e.jsxs("h2",{className:"title",children:[e.jsx("a",{href:`${_}post/${b}`,children:E(t.title,i.q)}),t.flair&&e.jsx("span",{className:"flair",children:t.flair}),t.media_type&&e.jsx("span",{className:"pill",children:t.media_type})]}),t.media_preview&&e.jsx("a",{href:`${_}post/${b}`,className:"media-wrap",children:e.jsx("img",{src:R(t.media_preview),alt:"",loading:"lazy",width:t.preview_width||void 0,height:t.preview_height||void 0})}),t.selftext_preview&&e.jsx("p",{className:"excerpt",children:E(t.selftext_preview,i.q)}),t.link_domain&&t.url&&e.jsxs("a",{className:"link-card",href:t.url,target:"_blank",rel:"noreferrer noopener",title:t.url,children:[e.jsx("div",{className:"link-domain",children:t.link_domain}),e.jsx("div",{className:"link-cta",children:"Open link â†—"})]}),e.jsxs("div",{className:"bottomline",children:[e.jsxs("span",{className:"score",children:["â–² ",t.score??0]}),e.jsx("span",{className:"dot",children:"â€¢"}),e.jsxs("span",{className:"comments",children:["ðŸ’¬ ",t.num_comments??0]}),e.jsx("span",{className:"spacer"}),t.permalink&&e.jsx("a",{className:"action",href:t.permalink,target:"_blank",rel:"noreferrer noopener",children:"View on Reddit"}),e.jsx("a",{className:"action",href:`${_}post/${b}`,children:"Details"}),t.saved_utc&&e.jsxs("span",{className:"saved",children:["Saved ID #",t.saved_utc]})]})]},b):null}),f<x&&e.jsx("div",{ref:g,style:{height:1}}),!x&&e.jsx("div",{className:"empty",children:"No results. Try clearing filters."})]}),e.jsx(F,{open:h,onClose:()=>p(!1),children:r&&e.jsx(C,{facets:r,query:i,onChange:l})})]}):e.jsx("div",{className:"feed loading",children:"Loadingâ€¦"})}export{X as default};
