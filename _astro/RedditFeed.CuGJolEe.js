import{B as g,j as e,a as D}from"./base.LUk68UGw.js";import{r as h}from"./index.RH_Wq4ov.js";function k({label:t,value:s=[],onChange:a,loadPath:n}){const[l,p]=h.useState(!1),[c,m]=h.useState(null),[u,r]=h.useState(""),[i,o]=h.useState("freq"),x=40,_=360;h.useEffect(()=>{l&&!c&&fetch(`${g}${n}`).then(d=>d.json()).then(m).catch(()=>m([]))},[l,c]);const b=h.useMemo(()=>{let d=c||[];if(u){const f=u.toLowerCase();d=d.filter(v=>v.name.toLowerCase().includes(f))}return i==="az"&&(d=d.slice().sort((f,v)=>f.name.localeCompare(v.name))),d},[c,u,i]),[E,L]=h.useState(0),j=Math.max(0,Math.floor(E/x)-4),w=Math.min(b.length,j+Math.ceil(_/x)+8),T=j*x,F=Math.max(0,(b.length-w)*x),N=d=>{const f=new Set(s);f.has(d)?f.delete(d):f.add(d),a(Array.from(f).sort())};return e.jsxs("div",{className:"lms",children:[e.jsx("div",{className:"label",children:t}),e.jsx("button",{type:"button",className:"picker",onClick:()=>p(!0),children:s.length?`${s.length} selected`:"Browse all…"}),l&&e.jsx("div",{className:"lms-backdrop",onClick:()=>p(!1)}),l&&e.jsxs("div",{className:"lms-modal",role:"dialog","aria-modal":"true","aria-label":t,children:[e.jsxs("div",{className:"lms-head",children:[e.jsx("strong",{children:t}),e.jsx("div",{className:"lms-spacer"}),e.jsx("button",{className:"pill",onClick:()=>o(i==="freq"?"az":"freq"),title:i==="freq"?"Sort A→Z":"Sort by frequency",children:i==="freq"?"A→Z":"Freq"}),e.jsx("button",{className:"pill",onClick:()=>p(!1),children:"Done"})]}),!!s.length&&e.jsx("div",{className:"lms-selected",children:s.map(d=>e.jsxs("button",{className:"tag",onClick:()=>N(d),title:"Remove",children:[d," ✕"]},d))}),e.jsx("input",{className:"lms-search",placeholder:`Search ${t.toLowerCase()}…`,value:u,onChange:d=>r(d.target.value)}),e.jsxs("div",{className:"lms-list",style:{height:_,overflowY:"auto"},onScroll:d=>L(d.currentTarget.scrollTop),children:[e.jsx("div",{style:{height:T}}),b.slice(j,w).map(d=>e.jsxs("label",{className:"lms-row",style:{height:x},children:[e.jsx("input",{type:"checkbox",checked:s.includes(d.name),onChange:()=>N(d.name)}),e.jsx("span",{className:"name",children:d.name}),typeof d.count=="number"&&e.jsx("span",{className:"count",children:d.count})]},d.name)),e.jsx("div",{style:{height:F}})]})]}),e.jsx("style",{children:`
        .picker { background:#2a2b2c; border:1px solid #343536; color:#d7dadc; border-radius:6px; padding:6px 10px; cursor:pointer; }
        .lms-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:70; }
        .lms-modal { position:fixed; top:8vh; left:50%; transform:translateX(-50%);
          width:min(92vw, 560px); max-height:84vh; background:#1a1a1b; border:1px solid #343536; border-radius:8px; padding:12px;
          display:flex; flex-direction:column; gap:8px; z-index:71; }
        .lms-head { display:flex; align-items:center; gap:8px; }
        .lms-spacer { flex:1; }
        .pill { background:#2a2b2c; border:1px solid #343536; color:#d7dadc; border-radius:999px; padding:4px 10px; cursor:pointer; font-size:12px; }
        .lms-selected { display:flex; flex-wrap:wrap; gap:6px; }
        .tag { background:#3b3c3d; border:1px solid #4a4c4f; color:#d7dadc; border-radius:999px; padding:2px 8px; font-size:12px; cursor:pointer; }
        .lms-search { width:100%; background:#0f1a1c; color:#d7dadc; border:1px solid #343536; border-radius:6px; padding:8px; }
        .lms-list { border:1px solid #343536; border-radius:6px; background:#0f1a1c; }
        .lms-row { display:flex; align-items:center; gap:8px; padding:0 10px; border-bottom:1px solid rgba(255,255,255,.05); }
        .name { flex:1; }
        .count { color:#818384; font-size:12px; }
        @media (max-width: 900px) {
          .lms-modal { top:0; bottom:0; left:auto; right:0; transform:none; width:min(92vw, 420px); max-height:100dvh; border-left:1px solid #343536; border-radius:0; }
        }
      `})]})}function y({facets:t,query:s,onChange:a}){const n=(c,m)=>{const u=new Set(s[c]||[]);u.has(m)?u.delete(m):u.add(m),a({...s,[c]:Array.from(u).sort(),page:1})},l=(c,m,u)=>e.jsxs("div",{className:"block",children:[e.jsx("div",{className:"label",children:c}),e.jsx("div",{className:"chips",children:u.map(r=>e.jsx("button",{className:`chip ${s[m]?.includes(r)?"on":""}`,onClick:()=>n(m,r),type:"button",children:r},r))})]}),p=()=>{const c=s.sort||"saved_asc";if(!/_asc$|_desc$/.test(c))return;const m=c.endsWith("_desc")?c.replace("_desc","_asc"):c.replace("_asc","_desc");a({...s,sort:m,page:1})};return(s.sort||"").endsWith("_desc"),e.jsxs("aside",{className:"filters",children:[e.jsx("div",{className:"row",children:e.jsx("input",{className:"search",type:"search",placeholder:"Search title & text…",value:s.q||"",onChange:c=>a({...s,q:c.target.value,page:1})})}),e.jsxs("div",{className:"row two",children:[e.jsxs("label",{children:["From",e.jsx("input",{type:"date",value:s.from||"",onChange:c=>a({...s,from:c.target.value,page:1})})]}),e.jsxs("label",{children:["To",e.jsx("input",{type:"date",value:s.to||"",onChange:c=>a({...s,to:c.target.value,page:1})})]})]}),e.jsx("div",{className:"row",children:e.jsxs("label",{children:["Sort",e.jsxs("div",{className:"sort-row",children:[e.jsxs("select",{value:s.sort,onChange:c=>a({...s,sort:c.target.value,page:1}),children:[e.jsx("option",{value:"saved_asc",children:"Save Order"}),e.jsx("option",{value:"created_desc",children:"Created date"}),e.jsx("option",{value:"score_desc",children:"Score"}),e.jsx("option",{value:"comments_desc",children:"Comments"}),e.jsx("option",{value:"title_asc",children:"Title"})]}),e.jsx("button",{type:"button",className:"dir",onClick:p,title:s.sort?.endsWith("_desc")?"Descending":"Ascending",children:s.sort?.endsWith("_desc")?"↓":"↑"})]})]})}),l("Media","media",t.mediaTypes||[]),l("Domain","domain",t.domains||[]),e.jsx(k,{label:"Subreddit",value:s.sub,onChange:c=>a({...s,sub:c,page:1}),loadPath:"data/indexes/subs-all.json"}),e.jsx(k,{label:"Author",value:s.author,onChange:c=>a({...s,author:c,page:1}),loadPath:"data/indexes/authors-all.json"}),l("Flair","flair",t.flairs||[]),e.jsx("div",{className:"row actions",children:e.jsx("button",{type:"button",onClick:()=>a({q:"",sub:[],author:[],flair:[],domain:[],media:[],from:"",to:"",sort:"saved_asc",page:1}),children:"Clear all"})})]})}function M({open:t,onClose:s,children:a}){return h.useEffect(()=>(document.body.style.overflow=t?"hidden":"",()=>document.body.style.overflow=""),[t]),h.useEffect(()=>{if(!t)return;const n=l=>{l.key==="Escape"&&s()};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[t,s]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mdrawer-backdrop",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",opacity:t?1:0,pointerEvents:t?"auto":"none",transition:"opacity .15s ease",zIndex:50},onClick:s}),e.jsxs("aside",{className:"mdrawer",style:{position:"fixed",top:0,right:0,height:"100dvh",width:"min(92vw, 420px)",borderLeft:"1px solid #343536",transform:t?"translateX(0)":"translateX(100%)",transition:"transform .2s ease",zIndex:51,padding:12,overflowY:"auto",background:"rgba(26, 26, 27, 0.5)"},role:"dialog","aria-modal":"true",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("h3",{style:{margin:0,fontSize:16},children:"Filters"}),e.jsx("button",{type:"button",onClick:s,style:{background:"#2a2b2c",border:"1px solid #343536",color:"#d7dadc",borderRadius:6,padding:"6px 10px",cursor:"pointer"},children:"Close"})]}),a]})]})}const $=new Set(["sub","author","flair","domain","media"]),z=new Set(["saved_asc, created_desc","score_desc","comments_desc","title_asc"]),A={q:"",sub:[],author:[],flair:[],domain:[],media:[],from:"",to:"",sort:"saved_asc",page:1};function S(t=globalThis.location?.search||""){const s={...A},a=new URLSearchParams(t);for(const[n,l]of a.entries())$.has(n)?s[n]=l?l.split(",").filter(Boolean):[]:n==="page"?s.page=Math.max(1,parseInt(l||"1",10)):s[n]=l||"";return z.has(s.sort)||(s.sort="saved_asc"),s}function I(t){const s=new URLSearchParams;t.q&&s.set("q",t.q);for(const n of $)t[n]?.length&&s.set(n,t[n].join(","));t.from&&s.set("from",t.from),t.to&&s.set("to",t.to),t.sort&&t.sort!=="saved_asc"&&s.set("sort",t.sort),t.page&&t.page!==1&&s.set("page",String(t.page));const a=s.toString();return a?`?${a}`:""}function R(t,s=!1){const a=I(t),n=`${location.pathname}${a}`;s?history.replaceState(null,"",n):history.pushState(null,"",n)}function P(t,s){let a=t.slice();const n=(r,i)=>!i?.length||r&&i.includes(r),l=r=>r?Math.floor(new Date(r).getTime()/1e3):null;a=a.filter(r=>n(r.subreddit,s.sub)&&n(r.author,s.author)&&n(r.flair,s.flair)&&n(r.link_domain,s.domain)&&n(r.media_type,s.media));const p=l(s.from),c=l(s.to);p&&(a=a.filter(r=>(r.created_utc??0)>=p)),c&&(a=a.filter(r=>(r.created_utc??0)<=c));const m=(s.q||"").trim().toLowerCase();switch(m&&(a=a.filter(r=>(r.title||"").toLowerCase().includes(m)||(r.selftext_preview||"").toLowerCase().includes(m))),s.sort||"saved_asc"){case"saved_asc":default:a.sort((r,i)=>(r.saved_utc??0)-(i.saved_utc??0));break;case"saved_desc":a.sort((r,i)=>(i.saved_utc??0)-(r.saved_utc??0));break;case"created_asc":a.sort((r,i)=>(r.created_utc??0)-(i.created_utc??0));break;case"created_desc":a.sort((r,i)=>(i.created_utc??0)-(r.created_utc??0));break;case"score_desc":a.sort((r,i)=>(i.score??0)-(r.score??0));break;case"score_asc":a.sort((r,i)=>(r.score??0)-(i.score??0));break;case"comments_desc":a.sort((r,i)=>(i.num_comments??0)-(r.num_comments??0));break;case"comments_asc":a.sort((r,i)=>(r.num_comments??0)-(i.num_comments??0));break;case"title_asc":a.sort((r,i)=>(r.title||"").localeCompare(i.title||""));break;case"title_desc":a.sort((r,i)=>(i.title||"").localeCompare(r.title||""));break}return a}function O(t){return t?new Date(t*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}function Q(t){if(!t)return null;try{const s=t.split("/").filter(Boolean),a=s.findIndex(n=>n==="comments");if(a!==-1&&s[a+1]){const n=s[a+1];return n.startsWith("t3_")?n:`t3_${n}`}}catch{}return null}function C(t,s){if(!s||!t)return t;const a=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`(${a})`,"gi");return t.split(n).map((l,p)=>n.test(l)?e.jsx("mark",{children:l},p):l)}function W(){const[t,s]=h.useState([]),[a,n]=h.useState(null),[l,p]=h.useState(S()),[c,m]=h.useState(!1);h.useEffect(()=>{fetch(`${g}data/indexes/posts-manifest.json`).then(o=>o.json()).then(s).catch(o=>console.error("Failed to load manifest",o))},[]),h.useEffect(()=>{fetch(`${g}data/indexes/facets.json`).then(o=>o.json()).then(n).catch(o=>console.error("Failed to load facets",o))},[]),h.useEffect(()=>{const o=()=>p(S(location.search));return window.addEventListener("popstate",o),()=>window.removeEventListener("popstate",o)},[]);const u=o=>{p(o),R(o)},r=h.useMemo(()=>P(t,l),[t,l]),i=r.length;return t.length?e.jsxs("div",{className:"feed grid",children:[e.jsx("div",{className:"left",children:a&&e.jsx(y,{facets:a,query:l,onChange:u})}),e.jsxs("div",{className:"right",children:[e.jsx("div",{className:"mobile-bar",children:e.jsx("button",{className:"btn",type:"button",onClick:()=>m(!0),children:"Filters"})}),e.jsxs("div",{className:"resultbar",children:[e.jsxs("span",{children:[i," result",i===1?"":"s"]}),l.q&&e.jsxs("span",{className:"meta",children:[" • searching “",l.q,"”"]})]}),(i?r:[]).map(o=>{const x=o.id||Q(o.permalink);return x?e.jsxs("article",{className:"post-card",children:[e.jsxs("div",{className:"topline",children:[e.jsxs("a",{className:"subreddit",href:`https://www.reddit.com/r/${o.subreddit}`,target:"_blank",rel:"noreferrer noopener",children:["r/",o.subreddit]}),e.jsx("span",{className:"dot",children:"•"}),e.jsxs("span",{className:"by",children:["Posted by ",e.jsxs("span",{className:"author",children:["u/",o.author]})]}),o.created_utc&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"dot",children:"•"}),e.jsx("time",{dateTime:new Date(o.created_utc*1e3).toISOString(),children:O(o.created_utc)})]})]}),e.jsxs("h2",{className:"title",children:[e.jsx("a",{href:`${g}post/${x}`,children:C(o.title,l.q)}),o.flair&&e.jsx("span",{className:"flair",children:o.flair}),o.media_type&&e.jsx("span",{className:"pill",children:o.media_type})]}),o.media_preview&&e.jsx("a",{href:`${g}post/${x}`,className:"media-wrap",children:e.jsx("img",{src:D(o.media_preview),alt:"",loading:"lazy",width:o.preview_width||void 0,height:o.preview_height||void 0})}),o.selftext_preview&&e.jsx("p",{className:"excerpt",children:C(o.selftext_preview,l.q)}),o.link_domain&&o.url&&e.jsxs("a",{className:"link-card",href:o.url,target:"_blank",rel:"noreferrer noopener",title:o.url,children:[e.jsx("div",{className:"link-domain",children:o.link_domain}),e.jsx("div",{className:"link-cta",children:"Open link ↗"})]}),e.jsxs("div",{className:"bottomline",children:[e.jsxs("span",{className:"score",children:["▲ ",o.score??0]}),e.jsx("span",{className:"dot",children:"•"}),e.jsxs("span",{className:"comments",children:["💬 ",o.num_comments??0]}),e.jsx("span",{className:"spacer"}),o.permalink&&e.jsx("a",{className:"action",href:o.permalink,target:"_blank",rel:"noreferrer noopener",children:"View on Reddit"}),e.jsx("a",{className:"action",href:`${g}post/${x}`,children:"Details"}),o.saved_utc&&e.jsxs("span",{className:"saved",children:["Saved ID #",o.saved_utc]})]})]},x):null}),!i&&e.jsx("div",{className:"empty",children:"No results. Try clearing filters."})]}),e.jsx(M,{open:c,onClose:()=>m(!1),children:a&&e.jsx(y,{facets:a,query:l,onChange:u})})]}):e.jsx("div",{className:"feed loading",children:"Loading…"})}export{W as default};
