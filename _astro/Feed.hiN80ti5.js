import{j as i}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.RH_Wq4ov.js";import{s as q,l as F,S as B}from"./Skeleton.rCBg4tsF.js";function A(t="",c=200){if(!t)return"";const s=String(t).replace(/[*_~`>#-]+/g," ").replace(/\[(.*?)\]\((.*?)\)/g,"$1").replace(/\s+/g," ").trim();if(s.length<=c)return s;const e=s.slice(0,c),n=e.lastIndexOf(" ");return(n>60?e.slice(0,n):e).trim()+"…"}function O(t=""){try{return new URL(t).hostname.replace(/^www\./,"")}catch{return""}}function T({post:t,favs:c,setFavs:s,base:e,searchTerm:n=""}){const u=c.has(t.id),h=()=>{const r=new Set(c);u?r.delete(t.id):r.add(t.id),s(r),q(r)},g=[t.subreddit?`r/${t.subreddit}`:"",t.author?`u/${t.author}`:"",t.flair||"",t.num_comments!=null?`${t.num_comments} comments`:"",t.saved_index!=null?`Saved #${t.saved_index}`:""].filter(Boolean).join(" • "),w=t.selftext_preview||t.selftext||t.media_type==="link"&&(t.url?`Link: ${O(t.url)}`:"")||"",y=A(w,200);function E(r,o){const d=(o||"").trim();if(!d)return r;try{const S=new RegExp(`(${d.replace(/[.*?^${}()|[\]\\]/g,"\\$&")})`,"ig");return String(r).split(S).map((m,f)=>S.test(m)?i.jsx("mark",{children:m},f):i.jsx("span",{children:m},f))}catch{return r}}return i.jsxs("article",{className:"card",style:{marginBottom:12},children:[t.media_preview?i.jsx("img",{src:t.media_preview,alt:"",loading:"lazy",decoding:"async",fetchpriority:"low",style:{width:"100%",borderRadius:10,display:"block"}}):null,i.jsx("h3",{style:{margin:"10px 2px"},children:i.jsx("a",{href:`${e}post/${encodeURIComponent(t.id)}`,onClick:()=>{try{const r="feed:scroll:"+location.search;sessionStorage.setItem(r,String(window.scrollY||0))}catch{}},children:t.title})}),i.jsx("div",{className:"meta",children:g}),y&&i.jsx("p",{className:"preview",children:E(y,n)}),i.jsxs("div",{className:"row",style:{marginTop:8},children:[i.jsx("button",{className:"button",onClick:h,children:u?"⭐ Unstar":"☆ Star"}),t.permalink&&i.jsx("a",{className:"button",href:t.permalink,target:"_blank",rel:"noopener noreferrer",children:"Open on Reddit ↗"})]})]})}const p=1e15;function R(t,c){const s=t.saved_index??p,e=c.saved_index??p;return s!==e?s-e:(c.created_utc??0)-(t.created_utc??0)}function M(t,c="asc"){const s=c==="desc"?-1:1;switch(t){case"saved":return(e,n)=>s*R(e,n);case"created":return(e,n)=>s*((e.created_utc??0)-(n.created_utc??0));case"score":return(e,n)=>s*((e.score??-p)-(n.score??-p));case"comments":return(e,n)=>s*((e.num_comments??-p)-(n.num_comments??-p));case"title":return(e,n)=>s*String(e.title).localeCompare(String(n.title));case"subreddit":return(e,n)=>s*String(e.subreddit).localeCompare(String(n.subreddit));case"author":return(e,n)=>s*String(e.author).localeCompare(String(n.author));case"domain":return(e,n)=>s*String(e.link_domain||"").localeCompare(String(n.link_domain||""));case"flair":return(e,n)=>s*String(e.flair||"").localeCompare(String(n.flair||""));default:return(e,n)=>s*R(e,n)}}const L="/Saved-Reddit/",k=L.endsWith("/")?L:L+"/";function Q(){const t=typeof window<"u",c=()=>t?window.location.search:"",[s,e]=l.useState(()=>new URLSearchParams(c()));return l.useEffect(()=>{if(!t)return;const u=()=>e(new URLSearchParams(window.location.search));return window.addEventListener("popstate",u),window.addEventListener("urlchange",u),()=>{window.removeEventListener("popstate",u),window.removeEventListener("urlchange",u)}},[t]),[s,u=>{if(!t)return;const h=new URL(window.location.href);u.forEach((g,w)=>h.searchParams.set(w,g)),Array.from(h.searchParams.keys()).forEach(g=>{h.searchParams.get(g)||h.searchParams.delete(g)}),window.history.pushState({},"",h),e(new URLSearchParams(h.search))}]}function Y({favoritesOnly:t=!1}){const[c,s]=l.useState(null),[e,n]=Q(),[u,h]=l.useState(30),g=l.useRef(),[w,y]=l.useState(new Set);l.useEffect(()=>{y(F())},[]),l.useEffect(()=>{if(typeof document>"u")return;const r=document.getElementById("searchInput"),o=document.getElementById("sortSelect");if(!r||!o)return;const d=e.get("sort")||"saved";e.get("dir"),o.value=d,r.value=e.get("q")||"";const S=m=>{const f=m.target.value;n(new URLSearchParams({...Object.fromEntries(e),q:f}))},v=m=>{const f=m.target.value,x=new URLSearchParams({...Object.fromEntries(e),sort:f});x.get("dir")||x.set("dir",f==="created"?"desc":"asc"),n(x)};return r.addEventListener("input",S),o.addEventListener("change",v),()=>{r.removeEventListener("input",S),o.removeEventListener("change",v)}},[e,n]),l.useEffect(()=>{fetch(`${k}data/indexes/posts-manifest.json`).then(r=>r.json()).then(s)},[]),l.useEffect(()=>{if(!g.current)return;const r=new IntersectionObserver(o=>{o.some(d=>d.isIntersecting)&&h(d=>d+30)},{rootMargin:"200px"});return r.observe(g.current),()=>r.disconnect()},[]),l.useEffect(()=>{if(typeof window>"u")return;const r="feed:scroll:"+window.location.search,o=Number(sessionStorage.getItem(r)||0);o>0&&requestAnimationFrame(()=>window.scrollTo(0,o))},[]);const E=l.useMemo(()=>{if(!c)return[];let r=c;t&&(r=r.filter(a=>w.has(a.id)));const o=(e.get("q")||"").toLowerCase().trim();o&&(r=r.filter(a=>a.title&&a.title.toLowerCase().includes(o)||a.selftext_preview&&a.selftext_preview.toLowerCase().includes(o)));const d=a=>(e.get(a)||"").split(",").filter(Boolean).map(decodeURIComponent),S=new Set(d("subs")),v=new Set(d("authors")),m=new Set(d("flairs")),f=new Set(d("media")),x=new Set(d("domains"));(S.size||v.size||m.size||f.size||x.size)&&(r=r.filter(a=>{const j=S.size&&a.subreddit&&S.has(String(a.subreddit)),_=v.size&&a.author&&v.has(String(a.author)),z=m.size&&a.flair&&m.has(String(a.flair)),I=f.size&&a.media_type&&f.has(String(a.media_type)),U=x.size&&a.link_domain&&x.has(String(a.link_domain));return!!(j||_||z||I||U)}));const C=e.get("sort")||"saved",P=e.get("dir")||(C==="created"?"desc":"asc"),N=M(C,P),$=e.get("favfirst")==="1";let b=[...r].sort(N);if($){const a=b.filter(_=>w.has(_.id)),j=b.filter(_=>!w.has(_.id));b=[...a,...j]}return b},[c,e,t,w]);return c?i.jsx("div",{className:"container",children:i.jsx("div",{className:"grid",children:i.jsxs("div",{className:"col",style:{gridColumn:"span 12"},children:[E.slice(0,u).map(r=>i.jsx(T,{post:r,favs:w,setFavs:y,base:k,searchTerm:(e.get("q")||"").trim()},r.id)),i.jsx("div",{ref:g,className:"sentinel"})]})})}):i.jsx("div",{className:"container","aria-busy":"true",children:Array.from({length:6}).map((r,o)=>i.jsx(B,{},o))})}export{Y as default};
