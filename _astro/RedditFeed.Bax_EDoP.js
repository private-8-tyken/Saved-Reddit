import{B as v,j as e,a as R}from"./base.LUk68UGw.js";import{r as m}from"./index.RH_Wq4ov.js";function $({label:t,value:s=[],onChange:a,loadPath:o}){const[c,i]=m.useState(!1),[h,u]=m.useState(null),[p,n]=m.useState(""),[l,N]=m.useState("freq"),f=40,j=360;m.useEffect(()=>{c&&!h&&fetch(`${v}${o}`).then(d=>d.json()).then(u).catch(()=>u([]))},[c,h]);const b=m.useMemo(()=>{let d=h||[];if(p){const g=p.toLowerCase();d=d.filter(S=>S.name.toLowerCase().includes(g))}return l==="az"&&(d=d.slice().sort((g,S)=>g.name.localeCompare(S.name))),d},[h,p,l]),[r,x]=m.useState(0),_=Math.max(0,Math.floor(r/f)-4),y=Math.min(b.length,_+Math.ceil(j/f)+8),w=_*f,F=Math.max(0,(b.length-y)*f),C=d=>{const g=new Set(s);g.has(d)?g.delete(d):g.add(d),a(Array.from(g).sort())};return e.jsxs("div",{className:"lms",children:[e.jsx("div",{className:"label",children:t}),e.jsx("button",{type:"button",className:"picker",onClick:()=>i(!0),children:s.length?`${s.length} selected`:"Browse allâ€¦"}),c&&e.jsx("div",{className:"lms-backdrop",onClick:()=>i(!1)}),c&&e.jsxs("div",{className:"lms-modal",role:"dialog","aria-modal":"true","aria-label":t,children:[e.jsxs("div",{className:"lms-head",children:[e.jsx("strong",{children:t}),e.jsx("div",{className:"lms-spacer"}),e.jsx("button",{className:"pill",onClick:()=>N(l==="freq"?"az":"freq"),title:l==="freq"?"Sort Aâ†’Z":"Sort by frequency",children:l==="freq"?"Aâ†’Z":"Freq"}),e.jsx("button",{className:"pill",onClick:()=>i(!1),children:"Done"})]}),!!s.length&&e.jsx("div",{className:"lms-selected",children:s.map(d=>e.jsxs("button",{className:"tag",onClick:()=>C(d),title:"Remove",children:[d," âœ•"]},d))}),e.jsx("input",{className:"lms-search",placeholder:`Search ${t.toLowerCase()}â€¦`,value:p,onChange:d=>n(d.target.value)}),e.jsxs("div",{className:"lms-list",style:{height:j,overflowY:"auto"},onScroll:d=>x(d.currentTarget.scrollTop),children:[e.jsx("div",{style:{height:w}}),b.slice(_,y).map(d=>e.jsxs("label",{className:"lms-row",style:{height:f},children:[e.jsx("input",{type:"checkbox",checked:s.includes(d.name),onChange:()=>C(d.name)}),e.jsx("span",{className:"name",children:d.name}),typeof d.count=="number"&&e.jsx("span",{className:"count",children:d.count})]},d.name)),e.jsx("div",{style:{height:F}})]})]}),e.jsx("style",{children:`
        .picker { background:#2a2b2c; border:1px solid #343536; color:#d7dadc; border-radius:6px; padding:6px 10px; cursor:pointer; }
        .lms-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:70; }
        .lms-modal { position:fixed; top:8vh; left:50%; transform:translateX(-50%);
          width:min(92vw, 560px); max-height:84vh; background:#1a1a1b; border:1px solid #343536; border-radius:8px; padding:12px;
          display:flex; flex-direction:column; gap:8px; z-index:71; }
        .lms-head { display:flex; align-items:center; gap:8px; }
        .lms-spacer { flex:1; }
        .pill { background:#2a2b2c; border:1px solid #343536; color:#d7dadc; border-radius:999px; padding:4px 10px; cursor:pointer; font-size:12px; }
        .lms-selected { display:flex; flex-wrap:wrap; gap:6px; }
        .tag { background:#3b3c3d; border:1px solid #4a4c4f; color:#d7dadc; border-radius:999px; padding:2px 8px; font-size:12px; cursor:pointer; }
        .lms-search { width:100%; background:#0f1a1c; color:#d7dadc; border:1px solid #343536; border-radius:6px; padding:8px; }
        .lms-list { border:1px solid #343536; border-radius:6px; background:#0f1a1c; }
        .lms-row { display:flex; align-items:center; gap:8px; padding:0 10px; border-bottom:1px solid rgba(255,255,255,.05); }
        .name { flex:1; }
        .count { color:#818384; font-size:12px; }
        @media (max-width: 900px) {
          .lms-modal { top:0; bottom:0; left:auto; right:0; transform:none; width:min(92vw, 420px); max-height:100dvh; border-left:1px solid #343536; border-radius:0; }
        }
      `})]})}function E({facets:t,query:s,onChange:a}){const o=(i,h)=>{const u=new Set(s[i]||[]);u.has(h)?u.delete(h):u.add(h),a({...s,[i]:Array.from(u).sort(),page:1})},c=(i,h,u)=>e.jsxs("div",{className:"block",children:[e.jsx("div",{className:"label",children:i}),e.jsx("div",{className:"chips",children:u.map(p=>e.jsx("button",{className:`chip ${s[h]?.includes(p)?"on":""}`,onClick:()=>o(h,p),type:"button",children:p},p))})]});return(s.sort||"").endsWith("_desc"),e.jsxs("aside",{className:"filters",children:[e.jsx("div",{className:"row",children:e.jsx("input",{className:"search",type:"search",placeholder:"Search title & textâ€¦",value:s.q||"",onChange:i=>a({...s,q:i.target.value,page:1})})}),e.jsxs("div",{className:"row two",children:[e.jsxs("label",{children:["From",e.jsx("input",{type:"date",value:s.from||"",onChange:i=>a({...s,from:i.target.value,page:1})})]}),e.jsxs("label",{children:["To",e.jsx("input",{type:"date",value:s.to||"",onChange:i=>a({...s,to:i.target.value,page:1})})]})]}),e.jsx("div",{className:"row",children:e.jsxs("label",{children:["Sort",e.jsxs("div",{className:"sort-row",children:[e.jsx("div",{className:"seg",children:[["saved","Save Order"],["created","Created"],["score","Score"],["comments","Comments"],["title","Title"]].map(([i,h])=>{const u=(s.sort||"").endsWith("_asc")?"asc":"desc",p=(s.sort||"saved_asc").startsWith(i+"_");return e.jsx("button",{type:"button",className:`seg-btn ${p?"on":""}`,onClick:()=>a({...s,sort:`${i}_${u}`,page:1}),"aria-pressed":p,children:h},i)})}),e.jsx("button",{type:"button",className:"dir",onClick:()=>{const i=s.sort||"saved_asc",h=i.endsWith("_desc")?i.replace("_desc","_asc"):i.replace("_asc","_desc");a({...s,sort:h,page:1})},title:s.sort?.endsWith("_desc")?"Descending":"Ascending",children:s.sort?.endsWith("_desc")?"â†“":"â†‘"})]})]})}),c("Media","media",t.mediaTypes||[]),c("Domain","domain",t.domains||[]),e.jsx($,{label:"Subreddit",value:s.sub,onChange:i=>a({...s,sub:i,page:1}),loadPath:"data/indexes/subs-all.json"}),e.jsx($,{label:"Author",value:s.author,onChange:i=>a({...s,author:i,page:1}),loadPath:"data/indexes/authors-all.json"}),c("Flair","flair",t.flairs||[]),e.jsx("div",{className:"row actions",children:e.jsx("button",{type:"button",onClick:()=>a({q:"",sub:[],author:[],flair:[],domain:[],media:[],from:"",to:"",sort:"saved_asc",page:1}),children:"Clear all"})})]})}let k=null;const D=t=>{k=t.touches[0].clientX},I=t=>{if(k==null)return;t.touches[0].clientX-k>60&&(onClose(),k=null)};function z({open:t,onClose:s,children:a}){return m.useEffect(()=>(document.body.style.overflow=t?"hidden":"",()=>document.body.style.overflow=""),[t]),m.useEffect(()=>{if(!t)return;const o=c=>{c.key==="Escape"&&s()};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[t,s]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mdrawer-backdrop",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",opacity:t?1:0,pointerEvents:t?"auto":"none",transition:"opacity .15s ease",zIndex:50},onClick:s}),e.jsxs("aside",{className:"mdrawer",style:{position:"fixed",top:0,right:0,height:"100dvh",width:"min(92vw, 420px)",borderLeft:"1px solid #343536",transform:t?"translateX(0)":"translateX(100%)",transition:"transform .2s ease",zIndex:51,padding:12,overflowY:"auto",background:"rgba(26, 26, 27, 0.5)"},role:"dialog","aria-modal":"true",onTouchStart:D,onTouchMove:I,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("h3",{style:{margin:0,fontSize:16},children:"Filters"}),e.jsx("button",{type:"button",onClick:s,style:{background:"#2a2b2c",border:"1px solid #343536",color:"#d7dadc",borderRadius:6,padding:"6px 10px",cursor:"pointer"},children:"Close"})]}),a]})]})}const M=new Set(["sub","author","flair","domain","media"]),A=new Set(["saved_asc, created_desc","score_desc","comments_desc","title_asc"]),O={q:"",sub:[],author:[],flair:[],domain:[],media:[],from:"",to:"",sort:"saved_asc",page:1};function T(t=globalThis.location?.search||""){const s={...O},a=new URLSearchParams(t);for(const[o,c]of a.entries())M.has(o)?s[o]=c?c.split(",").filter(Boolean):[]:o==="page"?s.page=Math.max(1,parseInt(c||"1",10)):s[o]=c||"";return A.has(s.sort)||(s.sort="saved_asc"),s}function P(t){const s=new URLSearchParams;t.q&&s.set("q",t.q);for(const o of M)t[o]?.length&&s.set(o,t[o].join(","));t.from&&s.set("from",t.from),t.to&&s.set("to",t.to),t.sort&&t.sort!=="saved_asc"&&s.set("sort",t.sort),t.page&&t.page!==1&&s.set("page",String(t.page));const a=s.toString();return a?`?${a}`:""}function Q(t,s=!1){const a=P(t),o=`${location.pathname}${a}`;s?history.replaceState(null,"",o):history.pushState(null,"",o)}function W(t,s){let a=t.slice();const o=(n,l)=>!l?.length||n&&l.includes(n),c=n=>n?Math.floor(new Date(n).getTime()/1e3):null;a=a.filter(n=>o(n.subreddit,s.sub)&&o(n.author,s.author)&&o(n.flair,s.flair)&&o(n.link_domain,s.domain)&&o(n.media_type,s.media));const i=c(s.from),h=c(s.to);i&&(a=a.filter(n=>(n.created_utc??0)>=i)),h&&(a=a.filter(n=>(n.created_utc??0)<=h));const u=(s.q||"").trim().toLowerCase();switch(u&&(a=a.filter(n=>(n.title||"").toLowerCase().includes(u)||(n.selftext_preview||"").toLowerCase().includes(u))),s.sort||"saved_asc"){case"saved_asc":default:a.sort((n,l)=>(n.saved_utc??0)-(l.saved_utc??0));break;case"saved_desc":a.sort((n,l)=>(l.saved_utc??0)-(n.saved_utc??0));break;case"created_asc":a.sort((n,l)=>(n.created_utc??0)-(l.created_utc??0));break;case"created_desc":a.sort((n,l)=>(l.created_utc??0)-(n.created_utc??0));break;case"score_desc":a.sort((n,l)=>(l.score??0)-(n.score??0));break;case"score_asc":a.sort((n,l)=>(n.score??0)-(l.score??0));break;case"comments_desc":a.sort((n,l)=>(l.num_comments??0)-(n.num_comments??0));break;case"comments_asc":a.sort((n,l)=>(n.num_comments??0)-(l.num_comments??0));break;case"title_asc":a.sort((n,l)=>(n.title||"").localeCompare(l.title||""));break;case"title_desc":a.sort((n,l)=>(l.title||"").localeCompare(n.title||""));break}return a}function B(t){return t?new Date(t*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}function X(t){if(!t)return null;try{const s=t.split("/").filter(Boolean),a=s.findIndex(o=>o==="comments");if(a!==-1&&s[a+1]){const o=s[a+1];return o.startsWith("t3_")?o:`t3_${o}`}}catch{}return null}function L(t,s){if(!s||!t)return t;const a=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=new RegExp(`(${a})`,"gi");return t.split(o).map((c,i)=>o.test(c)?e.jsx("mark",{children:c},i):c)}function Y(){const[t,s]=m.useState([]),[a,o]=m.useState(null),[c,i]=m.useState(T()),[h,u]=m.useState(!1),[p,n]=m.useState(30);m.useEffect(()=>{fetch(`${v}data/indexes/posts-manifest.json`).then(r=>r.json()).then(s).catch(r=>console.error("Failed to load manifest",r))},[]),m.useEffect(()=>{fetch(`${v}data/indexes/facets.json`).then(r=>r.json()).then(o).catch(r=>console.error("Failed to load facets",r))},[]),m.useEffect(()=>{const r=()=>i(T(location.search));return window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[]);const l=r=>{i(r),Q(r)},N=m.useMemo(()=>W(t,c),[t,c]),f=N.length,j=m.useRef(null),b=m.useRef(!1);return m.useEffect(()=>{n(30)},[c]),m.useEffect(()=>{if(!j.current)return;const r=j.current,x=new IntersectionObserver(_=>{_[0].isIntersecting&&(b.current||(b.current=!0,n(w=>w>=f?w:Math.min(w+30,f)),setTimeout(()=>b.current=!1,150)))},{root:null,rootMargin:"400px 0px",threshold:0});return x.observe(r),()=>x.disconnect()},[f,c]),t.length?e.jsxs("div",{className:"feed grid",children:[e.jsx("div",{className:"left",children:a&&e.jsx(E,{facets:a,query:c,onChange:l})}),e.jsxs("div",{className:"right",children:[e.jsx("div",{className:"mobile-bar",children:e.jsx("button",{className:"btn",type:"button",onClick:()=>u(!0),children:"Filters"})}),e.jsxs("div",{className:"resultbar",children:[e.jsxs("span",{children:[f," result",f===1?"":"s"]}),c.q&&e.jsxs("span",{className:"meta",children:[" â€¢ searching â€œ",c.q,"â€"]})]}),(f?N.slice(0,p):[]).map(r=>{const x=r.id||X(r.permalink);return x?e.jsxs("article",{className:"post-card",children:[e.jsxs("div",{className:"topline",children:[e.jsxs("a",{className:"subreddit",href:`https://www.reddit.com/r/${r.subreddit}`,target:"_blank",rel:"noreferrer noopener",children:["r/",r.subreddit]}),e.jsx("span",{className:"dot",children:"â€¢"}),e.jsxs("span",{className:"by",children:["Posted by ",e.jsxs("span",{className:"author",children:["u/",r.author]})]}),r.created_utc&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"dot",children:"â€¢"}),e.jsx("time",{dateTime:new Date(r.created_utc*1e3).toISOString(),children:B(r.created_utc)})]})]}),e.jsxs("h2",{className:"title",children:[e.jsx("a",{href:`${v}post/${x}`,children:L(r.title,c.q)}),r.flair&&e.jsx("span",{className:"flair",children:r.flair}),r.media_type&&e.jsx("span",{className:"pill",children:r.media_type})]}),r.media_preview&&e.jsx("a",{href:`${v}post/${x}`,className:"media-wrap",children:e.jsx("img",{src:R(r.media_preview),alt:"",loading:"lazy",width:r.preview_width||void 0,height:r.preview_height||void 0})}),r.selftext_preview&&e.jsx("p",{className:"excerpt",children:L(r.selftext_preview,c.q)}),r.link_domain&&r.url&&e.jsxs("a",{className:"link-card",href:r.url,target:"_blank",rel:"noreferrer noopener",title:r.url,children:[e.jsx("div",{className:"link-domain",children:r.link_domain}),e.jsx("div",{className:"link-cta",children:"Open link â†—"})]}),e.jsxs("div",{className:"bottomline",children:[e.jsxs("span",{className:"score",children:["â–² ",r.score??0]}),e.jsx("span",{className:"dot",children:"â€¢"}),e.jsxs("span",{className:"comments",children:["ðŸ’¬ ",r.num_comments??0]}),e.jsx("span",{className:"spacer"}),r.permalink&&e.jsx("a",{className:"action",href:r.permalink,target:"_blank",rel:"noreferrer noopener",children:"View on Reddit"}),e.jsx("a",{className:"action",href:`${v}post/${x}`,children:"Details"}),r.saved_utc&&e.jsxs("span",{className:"saved",children:["Saved ID #",r.saved_utc]})]})]},x):null}),p<f&&e.jsx("div",{ref:j,style:{height:1}}),!f&&e.jsx("div",{className:"empty",children:"No results. Try clearing filters."})]}),e.jsx(z,{open:h,onClose:()=>u(!1),children:a&&e.jsx(E,{facets:a,query:c,onChange:l})})]}):e.jsx("div",{className:"feed loading",children:"Loadingâ€¦"})}export{Y as default};
