import{B as _,j as e,a as F}from"./base.LUk68UGw.js";import{r as m,R as T}from"./index.DtoOFyvK.js";function E({label:a,value:t=[],onChange:r,loadPath:i}){const[c,p]=m.useState(!1),[o,d]=m.useState(null),[f,n]=m.useState(""),[l,w]=m.useState("freq"),g=40,s=360;m.useEffect(()=>{c&&!o&&fetch(`${_}${i}`).then(h=>h.json()).then(d).catch(()=>d([]))},[c,o]);const x=m.useMemo(()=>{let h=o||[];if(f){const b=f.toLowerCase();h=h.filter(N=>N.name.toLowerCase().includes(b))}return l==="az"&&(h=h.slice().sort((b,N)=>b.name.localeCompare(N.name))),h},[o,f,l]),[u,j]=m.useState(0),v=Math.max(0,Math.floor(u/g)-4),k=Math.min(x.length,v+Math.ceil(s/g)+8),y=v*g,R=Math.max(0,(x.length-k)*g),S=h=>{const b=new Set(t);b.has(h)?b.delete(h):b.add(h),r(Array.from(b).sort())};return e.jsxs("div",{className:"lms",children:[e.jsx("div",{className:"label",children:a}),e.jsx("button",{type:"button",className:"picker",onClick:()=>p(!0),children:t.length?`${t.length} selected`:"Browse allâ€¦"}),c&&e.jsx("div",{className:"lms-backdrop",onClick:()=>p(!1)}),c&&e.jsxs("div",{className:"lms-modal",role:"dialog","aria-modal":"true","aria-label":a,children:[e.jsxs("div",{className:"lms-head",children:[e.jsx("strong",{children:a}),e.jsx("div",{className:"lms-spacer"}),e.jsx("button",{className:"pill",onClick:()=>w(l==="freq"?"az":"freq"),title:l==="freq"?"Sort Aâ†’Z":"Sort by frequency",children:l==="freq"?"Aâ†’Z":"Freq"}),e.jsx("button",{className:"pill",onClick:()=>p(!1),children:"Done"})]}),!!t.length&&e.jsx("div",{className:"lms-selected",children:t.map(h=>e.jsxs("button",{className:"tag",onClick:()=>S(h),title:"Remove",children:[h," âœ•"]},h))}),e.jsx("input",{className:"lms-search",placeholder:`Search ${a.toLowerCase()}â€¦`,value:f,onChange:h=>n(h.target.value)}),e.jsxs("div",{className:"lms-list",style:{height:s,overflowY:"auto"},onScroll:h=>j(h.currentTarget.scrollTop),children:[e.jsx("div",{style:{height:y}}),x.slice(v,k).map(h=>e.jsxs("label",{className:"lms-row",style:{height:g},children:[e.jsx("input",{type:"checkbox",checked:t.includes(h.name),onChange:()=>S(h.name)}),e.jsx("span",{className:"name",children:h.name}),typeof h.count=="number"&&e.jsx("span",{className:"count",children:h.count})]},h.name)),e.jsx("div",{style:{height:R}})]})]}),e.jsx("style",{children:`
        .picker { background:#2a2b2c; border:1px solid #343536; color:#d7dadc; border-radius:6px; padding:6px 10px; cursor:pointer; }
        .lms-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:70; }
        .lms-modal { position:fixed; top:8vh; left:50%; transform:translateX(-50%);
          width:min(92vw, 560px); max-height:84vh; background:#1a1a1b; border:1px solid #343536; border-radius:8px; padding:12px;
          display:flex; flex-direction:column; gap:8px; z-index:71; }
        .lms-head { display:flex; align-items:center; gap:8px; }
        .lms-spacer { flex:1; }
        .pill { background:#2a2b2c; border:1px solid #343536; color:#d7dadc; border-radius:999px; padding:4px 10px; cursor:pointer; font-size:12px; }
        .lms-selected { display:flex; flex-wrap:wrap; gap:6px; }
        .tag { background:#3b3c3d; border:1px solid #4a4c4f; color:#d7dadc; border-radius:999px; padding:2px 8px; font-size:12px; cursor:pointer; }
        .lms-search { width:100%; background:#0f1a1c; color:#d7dadc; border:1px solid #343536; border-radius:6px; padding:8px; }
        .lms-list { border:1px solid #343536; border-radius:6px; background:#0f1a1c; }
        .lms-row { display:flex; align-items:center; gap:8px; padding:0 10px; border-bottom:1px solid rgba(255,255,255,.05); }
        .name { flex:1; }
        .count { color:#818384; font-size:12px; }
        @media (max-width: 900px) {
          .lms-modal { top:0; bottom:0; left:auto; right:0; transform:none; width:min(92vw, 420px); max-height:100dvh; border-left:1px solid #343536; border-radius:0; }
        }
      `})]})}function M({facets:a,query:t,onChange:r}){const i=(o,d)=>{const f=new Set(t[o]||[]);f.has(d)?f.delete(d):f.add(d),r({...t,[o]:Array.from(f).sort(),page:1})},c=(o,d,f)=>e.jsxs("div",{className:"block",children:[e.jsx("div",{className:"label",children:o}),e.jsx("div",{className:"chips",children:f.map(n=>e.jsx("button",{className:`chip ${t[d]?.includes(n)?"on":""}`,onClick:()=>i(d,n),type:"button",children:n},n))})]}),p=()=>{const o=t.sort||"saved_asc";if(!/_asc$|_desc$/.test(o))return;const d=o.endsWith("_desc")?o.replace("_desc","_asc"):o.replace("_asc","_desc");r({...t,sort:d,page:1})};return(t.sort||"").endsWith("_desc"),e.jsxs("aside",{className:"filters",children:[e.jsx("div",{className:"row",children:e.jsx("input",{className:"search",type:"search",placeholder:"Search title & textâ€¦",value:t.q||"",onChange:o=>r({...t,q:o.target.value,page:1})})}),e.jsxs("div",{className:"row two",children:[e.jsxs("label",{children:["From",e.jsx("input",{type:"date",value:t.from||"",onChange:o=>r({...t,from:o.target.value,page:1})})]}),e.jsxs("label",{children:["To",e.jsx("input",{type:"date",value:t.to||"",onChange:o=>r({...t,to:o.target.value,page:1})})]})]}),e.jsx("div",{className:"row",children:e.jsxs("label",{children:["Sort",e.jsxs("div",{className:"sort-row",children:[e.jsxs("select",{value:t.sort,onChange:o=>r({...t,sort:o.target.value,page:1}),children:[e.jsx("option",{value:"saved_asc",children:"Save Order"}),e.jsx("option",{value:"created_desc",children:"Created date"}),e.jsx("option",{value:"score_desc",children:"Score"}),e.jsx("option",{value:"comments_desc",children:"Comments"}),e.jsx("option",{value:"title_asc",children:"Title"})]}),e.jsx("button",{type:"button",className:"dir",onClick:p,title:t.sort?.endsWith("_desc")?"Descending":"Ascending",children:t.sort?.endsWith("_desc")?"â†“":"â†‘"})]})]})}),c("Media","media",a.mediaTypes||[]),c("Domain","domain",a.domains||[]),e.jsx(E,{label:"Subreddit",value:t.sub,onChange:o=>r({...t,sub:o,page:1}),loadPath:"data/indexes/subs-all.json"}),e.jsx(E,{label:"Author",value:t.author,onChange:o=>r({...t,author:o,page:1}),loadPath:"data/indexes/authors-all.json"}),c("Flair","flair",a.flairs||[]),e.jsx("div",{className:"row actions",children:e.jsx("button",{type:"button",onClick:()=>r({q:"",sub:[],author:[],flair:[],domain:[],media:[],from:"",to:"",sort:"saved_asc",page:1}),children:"Clear all"})})]})}function z({open:a,onClose:t,children:r}){const i=m.useRef(null);m.useEffect(()=>{a&&i.current?.focus()},[a]),m.useEffect(()=>(document.body.style.overflow=a?"hidden":"",()=>document.body.style.overflow=""),[a]),m.useEffect(()=>{if(!a)return;const u=j=>j.key==="Escape"&&t();return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[a,t]);const c=m.useRef({x:null,y:null}),p=m.useRef(!1),o=m.useCallback((u,j)=>{c.current={x:u,y:j},p.current=!0},[]),d=m.useCallback((u,j)=>{if(!p.current||c.current.x==null)return;const v=u-c.current.x,k=j-c.current.y;if(Math.abs(v)<10||Math.abs(k)>Math.abs(v))return;const y=Math.max(40,Math.min(140,window.innerWidth*.18));v>y&&(p.current=!1,t())},[t]),f=m.useCallback(()=>{p.current=!1,c.current={x:null,y:null}},[]),n=u=>o(u.touches[0].clientX,u.touches[0].clientY),l=u=>d(u.touches[0].clientX,u.touches[0].clientY),w=f,g=u=>u.pointerType==="mouse"&&o(u.clientX,u.clientY),s=u=>u.pointerType==="mouse"&&d(u.clientX,u.clientY),x=u=>u.pointerType==="mouse"&&f();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mdrawer-backdrop",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",opacity:a?1:0,pointerEvents:a?"auto":"none",transition:"opacity .15s ease",zIndex:50},onClick:t}),e.jsxs("aside",{ref:i,tabIndex:-1,role:"dialog","aria-modal":"true","aria-label":"Filters",className:"mdrawer",style:{position:"fixed",top:0,right:0,height:"100dvh",width:"min(92vw, 420px)",borderLeft:"1px solid #343536",transform:a?"translateX(0)":"translateX(100%)",transition:"transform .2s ease",zIndex:51,padding:12,overflowY:"auto",background:"rgba(26, 26, 27, 0.5)",touchAction:"pan-y"},onTouchStart:n,onTouchMove:l,onTouchEnd:w,onPointerDown:g,onPointerMove:s,onPointerUp:x,children:[e.jsx("div",{"aria-hidden":!0,style:{position:"absolute",left:6,top:"40%",width:6,height:46,borderRadius:999,background:"rgba(215,218,220,.55)",boxShadow:"0 0 0 1px rgba(0,0,0,.25)"}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("h3",{style:{margin:0,fontSize:16},children:"Filters"}),e.jsx("button",{type:"button",onClick:t,style:{background:"#2a2b2c",border:"1px solid #343536",color:"#d7dadc",borderRadius:6,padding:"6px 10px",cursor:"pointer"},children:"Close"})]}),r]})]})}const $=new Set(["sub","author","flair","domain","media"]),D=new Set(["saved_asc, created_desc","score_desc","comments_desc","title_asc"]),I={q:"",sub:[],author:[],flair:[],domain:[],media:[],from:"",to:"",sort:"saved_asc",page:1};function C(a=globalThis.location?.search||""){const t={...I},r=new URLSearchParams(a);for(const[i,c]of r.entries())$.has(i)?t[i]=c?c.split(",").filter(Boolean):[]:i==="page"?t.page=Math.max(1,parseInt(c||"1",10)):t[i]=c||"";return D.has(t.sort)||(t.sort="saved_asc"),t}function A(a){const t=new URLSearchParams;a.q&&t.set("q",a.q);for(const i of $)a[i]?.length&&t.set(i,a[i].join(","));a.from&&t.set("from",a.from),a.to&&t.set("to",a.to),a.sort&&a.sort!=="saved_asc"&&t.set("sort",a.sort),a.page&&a.page!==1&&t.set("page",String(a.page));const r=t.toString();return r?`?${r}`:""}function P(a,t=!1){const r=A(a),i=`${location.pathname}${r}`;t?history.replaceState(null,"",i):history.pushState(null,"",i)}function Y(a,t){let r=a.slice();const i=(n,l)=>!l?.length||n&&l.includes(n),c=n=>n?Math.floor(new Date(n).getTime()/1e3):null;r=r.filter(n=>i(n.subreddit,t.sub)&&i(n.author,t.author)&&i(n.flair,t.flair)&&i(n.link_domain,t.domain)&&i(n.media_type,t.media));const p=c(t.from),o=c(t.to);p&&(r=r.filter(n=>(n.created_utc??0)>=p)),o&&(r=r.filter(n=>(n.created_utc??0)<=o));const d=(t.q||"").trim().toLowerCase();switch(d&&(r=r.filter(n=>(n.title||"").toLowerCase().includes(d)||(n.selftext_preview||"").toLowerCase().includes(d))),t.sort||"saved_asc"){case"saved_asc":default:r.sort((n,l)=>(n.saved_utc??0)-(l.saved_utc??0));break;case"saved_desc":r.sort((n,l)=>(l.saved_utc??0)-(n.saved_utc??0));break;case"created_asc":r.sort((n,l)=>(n.created_utc??0)-(l.created_utc??0));break;case"created_desc":r.sort((n,l)=>(l.created_utc??0)-(n.created_utc??0));break;case"score_desc":r.sort((n,l)=>(l.score??0)-(n.score??0));break;case"score_asc":r.sort((n,l)=>(n.score??0)-(l.score??0));break;case"comments_desc":r.sort((n,l)=>(l.num_comments??0)-(n.num_comments??0));break;case"comments_asc":r.sort((n,l)=>(n.num_comments??0)-(l.num_comments??0));break;case"title_asc":r.sort((n,l)=>(n.title||"").localeCompare(l.title||""));break;case"title_desc":r.sort((n,l)=>(l.title||"").localeCompare(n.title||""));break}return r}function O(a){return a?new Date(a*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}function X(a){if(!a)return null;try{const t=a.split("/").filter(Boolean),r=t.findIndex(i=>i==="comments");if(r!==-1&&t[r+1]){const i=t[r+1];return i.startsWith("t3_")?i:`t3_${i}`}}catch{}return null}function L(a,t){if(!t||!a)return a;const r=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`(${r})`,"gi");return a.split(i).map((c,p)=>i.test(c)?e.jsx("mark",{children:c},p):c)}function B({onOpen:a}){const t=T.useRef({x:null,y:null}),r=T.useRef(!1),i=o=>{const d=o.touches[0];t.current={x:d.clientX,y:d.clientY},r.current=!0},c=o=>{if(!r.current||t.current.x==null)return;const d=o.touches[0],f=d.clientX-t.current.x,n=d.clientY-t.current.y;if(Math.abs(n)>Math.abs(f))return;const l=Math.max(40,Math.min(140,window.innerWidth*.18));f<-l&&(r.current=!1,a())},p=()=>{r.current=!1,t.current={x:null,y:null}};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @media (min-width: 900px) {
          .edge-open-zone, .edge-handle { display: none; }
        }
        .edge-handle:focus-visible { outline: 2px solid rgba(255,255,255,.6); outline-offset: 2px; }
      `}),e.jsx("button",{type:"button",className:"edge-handle","aria-label":"Open filters",onClick:a,style:{position:"fixed",top:"50%",right:0,transform:"translateY(-50%)",zIndex:49,display:"flex",alignItems:"center",justifyContent:"center",padding:"8px 6px",width:32,borderTopLeftRadius:10,borderBottomLeftRadius:10,border:"1px solid rgba(255,255,255,.16)",borderRight:"none",background:"linear-gradient(180deg, rgba(36,37,38,.92), rgba(20,20,21,.92))",color:"#d7dadc",boxShadow:"0 2px 10px rgba(0,0,0,.35)",backdropFilter:"blur(6px)",cursor:"pointer"},children:e.jsx("span",{"aria-hidden":!0,style:{writingMode:"vertical-rl",textOrientation:"mixed",fontSize:12,letterSpacing:1,opacity:.9,userSelect:"none"},children:"Filters"})}),e.jsx("div",{className:"edge-open-zone",style:{position:"fixed",top:0,right:0,width:28,height:"100dvh",zIndex:48,touchAction:"pan-y"},onTouchStart:i,onTouchMove:c,onTouchEnd:p})]})}function U(){const[a,t]=m.useState([]),[r,i]=m.useState(null),[c,p]=m.useState(C()),[o,d]=m.useState(!1),[f,n]=m.useState(!1);m.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const s=window.matchMedia("(max-width: 900px)"),x=u=>n(u.matches);return n(s.matches),s.addEventListener?s.addEventListener("change",x):s.addListener(x),()=>{s.removeEventListener?s.removeEventListener("change",x):s.removeListener(x)}},[]),m.useEffect(()=>{fetch(`${_}data/indexes/posts-manifest.json`).then(s=>s.json()).then(t).catch(s=>console.error("Failed to load manifest",s))},[]),m.useEffect(()=>{fetch(`${_}data/indexes/facets.json`).then(s=>s.json()).then(i).catch(s=>console.error("Failed to load facets",s))},[]),m.useEffect(()=>{const s=()=>p(C(location.search));return window.addEventListener("popstate",s),()=>window.removeEventListener("popstate",s)},[]);const l=s=>{p(s),P(s)},w=m.useMemo(()=>Y(a,c),[a,c]),g=w.length;return a.length?e.jsxs("div",{className:"feed grid",children:[e.jsx("div",{className:"left",children:r&&e.jsx(M,{facets:r,query:c,onChange:l})}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"resultbar",children:[e.jsxs("span",{children:[g," result",g===1?"":"s"]}),c.q&&e.jsxs("span",{className:"meta",children:[" â€¢ searching â€œ",c.q,"â€"]})]}),(g?w:[]).map(s=>{const x=s.id||X(s.permalink);return x?e.jsxs("article",{className:"post-card",children:[e.jsxs("div",{className:"topline",children:[e.jsxs("a",{className:"subreddit",href:`https://www.reddit.com/r/${s.subreddit}`,target:"_blank",rel:"noreferrer noopener",children:["r/",s.subreddit]}),e.jsx("span",{className:"dot",children:"â€¢"}),e.jsxs("span",{className:"by",children:["Posted by ",e.jsxs("span",{className:"author",children:["u/",s.author]})]}),s.created_utc&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"dot",children:"â€¢"}),e.jsx("time",{dateTime:new Date(s.created_utc*1e3).toISOString(),children:O(s.created_utc)})]})]}),e.jsxs("h2",{className:"title",children:[e.jsx("a",{href:`${_}post/${x}`,children:L(s.title,c.q)}),s.flair&&e.jsx("span",{className:"flair",children:s.flair}),s.media_type&&e.jsx("span",{className:"pill",children:s.media_type})]}),s.media_preview&&e.jsx("a",{href:`${_}post/${x}`,className:"media-wrap",children:e.jsx("img",{src:F(s.media_preview),alt:"",loading:"lazy",width:s.preview_width||void 0,height:s.preview_height||void 0})}),s.selftext_preview&&e.jsx("p",{className:"excerpt",children:L(s.selftext_preview,c.q)}),s.link_domain&&s.url&&e.jsxs("a",{className:"link-card",href:s.url,target:"_blank",rel:"noreferrer noopener",title:s.url,children:[e.jsx("div",{className:"link-domain",children:s.link_domain}),e.jsx("div",{className:"link-cta",children:"Open link â†—"})]}),e.jsxs("div",{className:"bottomline",children:[e.jsxs("span",{className:"score",children:["â–² ",s.score??0]}),e.jsx("span",{className:"dot",children:"â€¢"}),e.jsxs("span",{className:"comments",children:["ðŸ’¬ ",s.num_comments??0]}),e.jsx("span",{className:"spacer"}),s.permalink&&e.jsx("a",{className:"action",href:s.permalink,target:"_blank",rel:"noreferrer noopener",children:"View on Reddit"}),e.jsx("a",{className:"action",href:`${_}post/${x}`,children:"Details"}),Number.isFinite(s.saved_utc)&&e.jsxs("span",{className:"saved",children:["Saved index #",s.saved_utc]})]})]},x):null}),!g&&e.jsx("div",{className:"empty",children:"No results. Try clearing filters."})]}),e.jsx(z,{open:o,onClose:()=>d(!1),children:r&&e.jsx(M,{facets:r,query:c,onChange:l})}),f&&!o&&e.jsx(B,{onOpen:()=>d(!0)})]}):e.jsx("div",{className:"feed loading",children:"Loadingâ€¦"})}export{U as default};
