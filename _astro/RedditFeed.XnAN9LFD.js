import{B as g,j as e,a as D}from"./base.LUk68UGw.js";import{r as h}from"./index.RH_Wq4ov.js";function k({label:t,value:s=[],onChange:a,loadPath:o}){const[i,p]=h.useState(!1),[l,m]=h.useState(null),[u,n]=h.useState(""),[c,r]=h.useState("freq"),x=40,v=360;h.useEffect(()=>{i&&!l&&fetch(`${g}${o}`).then(d=>d.json()).then(m).catch(()=>m([]))},[i,l]);const b=h.useMemo(()=>{let d=l||[];if(u){const f=u.toLowerCase();d=d.filter(w=>w.name.toLowerCase().includes(f))}return c==="az"&&(d=d.slice().sort((f,w)=>f.name.localeCompare(w.name))),d},[l,u,c]),[L,T]=h.useState(0),j=Math.max(0,Math.floor(L/x)-4),_=Math.min(b.length,j+Math.ceil(v/x)+8),F=j*x,M=Math.max(0,(b.length-_)*x),N=d=>{const f=new Set(s);f.has(d)?f.delete(d):f.add(d),a(Array.from(f).sort())};return e.jsxs("div",{className:"lms",children:[e.jsx("div",{className:"label",children:t}),e.jsx("button",{type:"button",className:"picker",onClick:()=>p(!0),children:s.length?`${s.length} selected`:"Browse allâ€¦"}),i&&e.jsx("div",{className:"lms-backdrop",onClick:()=>p(!1)}),i&&e.jsxs("div",{className:"lms-modal",role:"dialog","aria-modal":"true","aria-label":t,children:[e.jsxs("div",{className:"lms-head",children:[e.jsx("strong",{children:t}),e.jsx("div",{className:"lms-spacer"}),e.jsx("button",{className:"pill",onClick:()=>r(c==="freq"?"az":"freq"),title:c==="freq"?"Sort Aâ†’Z":"Sort by frequency",children:c==="freq"?"Aâ†’Z":"Freq"}),e.jsx("button",{className:"pill",onClick:()=>p(!1),children:"Done"})]}),!!s.length&&e.jsx("div",{className:"lms-selected",children:s.map(d=>e.jsxs("button",{className:"tag",onClick:()=>N(d),title:"Remove",children:[d," âœ•"]},d))}),e.jsx("input",{className:"lms-search",placeholder:`Search ${t.toLowerCase()}â€¦`,value:u,onChange:d=>n(d.target.value)}),e.jsxs("div",{className:"lms-list",style:{height:v,overflowY:"auto"},onScroll:d=>T(d.currentTarget.scrollTop),children:[e.jsx("div",{style:{height:F}}),b.slice(j,_).map(d=>e.jsxs("label",{className:"lms-row",style:{height:x},children:[e.jsx("input",{type:"checkbox",checked:s.includes(d.name),onChange:()=>N(d.name)}),e.jsx("span",{className:"name",children:d.name}),typeof d.count=="number"&&e.jsx("span",{className:"count",children:d.count})]},d.name)),e.jsx("div",{style:{height:M}})]})]}),e.jsx("style",{children:`
        .picker { background:#2a2b2c; border:1px solid #343536; color:#d7dadc; border-radius:6px; padding:6px 10px; cursor:pointer; }
        .lms-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:70; }
        .lms-modal { position:fixed; top:8vh; left:50%; transform:translateX(-50%);
          width:min(92vw, 560px); max-height:84vh; background:#1a1a1b; border:1px solid #343536; border-radius:8px; padding:12px;
          display:flex; flex-direction:column; gap:8px; z-index:71; }
        .lms-head { display:flex; align-items:center; gap:8px; }
        .lms-spacer { flex:1; }
        .pill { background:#2a2b2c; border:1px solid #343536; color:#d7dadc; border-radius:999px; padding:4px 10px; cursor:pointer; font-size:12px; }
        .lms-selected { display:flex; flex-wrap:wrap; gap:6px; }
        .tag { background:#3b3c3d; border:1px solid #4a4c4f; color:#d7dadc; border-radius:999px; padding:2px 8px; font-size:12px; cursor:pointer; }
        .lms-search { width:100%; background:#0f1a1c; color:#d7dadc; border:1px solid #343536; border-radius:6px; padding:8px; }
        .lms-list { border:1px solid #343536; border-radius:6px; background:#0f1a1c; }
        .lms-row { display:flex; align-items:center; gap:8px; padding:0 10px; border-bottom:1px solid rgba(255,255,255,.05); }
        .name { flex:1; }
        .count { color:#818384; font-size:12px; }
        @media (max-width: 900px) {
          .lms-modal { top:0; bottom:0; left:auto; right:0; transform:none; width:min(92vw, 420px); max-height:100dvh; border-left:1px solid #343536; border-radius:0; }
        }
      `})]})}function y({facets:t,query:s,onChange:a}){const o=(l,m)=>{const u=new Set(s[l]||[]);u.has(m)?u.delete(m):u.add(m),a({...s,[l]:Array.from(u).sort(),page:1})},i=(l,m,u)=>e.jsxs("div",{className:"block",children:[e.jsx("div",{className:"label",children:l}),e.jsx("div",{className:"chips",children:u.map(n=>e.jsx("button",{className:`chip ${s[m]?.includes(n)?"on":""}`,onClick:()=>o(m,n),type:"button",children:n},n))})]}),p=()=>{const l=s.sort||"created_desc";if(!/_asc$|_desc$/.test(l))return;const m=l.endsWith("_desc")?l.replace("_desc","_asc"):l.replace("_asc","_desc");a({...s,sort:m,page:1})};return(s.sort||"").endsWith("_desc"),e.jsxs("aside",{className:"filters",children:[e.jsx("div",{className:"row",children:e.jsx("input",{className:"search",type:"search",placeholder:"Search title & textâ€¦",value:s.q||"",onChange:l=>a({...s,q:l.target.value,page:1})})}),e.jsxs("div",{className:"row two",children:[e.jsxs("label",{children:["From",e.jsx("input",{type:"date",value:s.from||"",onChange:l=>a({...s,from:l.target.value,page:1})})]}),e.jsxs("label",{children:["To",e.jsx("input",{type:"date",value:s.to||"",onChange:l=>a({...s,to:l.target.value,page:1})})]})]}),e.jsx("div",{className:"row",children:e.jsxs("label",{children:["Sort",e.jsxs("div",{className:"sort-row",children:[e.jsxs("select",{value:s.sort,onChange:l=>a({...s,sort:l.target.value,page:1}),children:[e.jsx("option",{value:"created_desc",children:"Created date"}),e.jsx("option",{value:"score_desc",children:"Score"}),e.jsx("option",{value:"comments_desc",children:"Comments"}),e.jsx("option",{value:"title_asc",children:"Title"})]}),e.jsx("button",{type:"button",className:"dir",onClick:p,title:s.sort?.endsWith("_desc")?"Descending":"Ascending",children:s.sort?.endsWith("_desc")?"â†“":"â†‘"})]})]})}),i("Media","media",t.mediaTypes||[]),i("Domain","domain",t.domains||[]),e.jsx(k,{label:"Subreddit",value:s.sub,onChange:l=>a({...s,sub:l,page:1}),loadPath:"data/indexes/subs-all.json"}),e.jsx(k,{label:"Author",value:s.author,onChange:l=>a({...s,author:l,page:1}),loadPath:"data/indexes/authors-all.json"}),i("Flair","flair",t.flairs||[]),e.jsx("div",{className:"row actions",children:e.jsx("button",{type:"button",onClick:()=>a({q:"",sub:[],author:[],flair:[],domain:[],media:[],from:"",to:"",sort:"created_desc",page:1}),children:"Clear all"})})]})}function z({open:t,onClose:s,children:a}){return h.useEffect(()=>(document.body.style.overflow=t?"hidden":"",()=>document.body.style.overflow=""),[t]),h.useEffect(()=>{if(!t)return;const o=i=>{i.key==="Escape"&&s()};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[t,s]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mdrawer-backdrop",style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",opacity:t?1:0,pointerEvents:t?"auto":"none",transition:"opacity .15s ease",zIndex:50},onClick:s}),e.jsxs("aside",{className:"mdrawer",style:{position:"fixed",top:0,right:0,height:"100dvh",width:"min(92vw, 420px)",borderLeft:"1px solid #343536",transform:t?"translateX(0)":"translateX(100%)",transition:"transform .2s ease",zIndex:51,padding:12,overflowY:"auto",background:"rgba(26, 26, 27, 0.5)"},role:"dialog","aria-modal":"true",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("h3",{style:{margin:0,fontSize:16},children:"Filters"}),e.jsx("button",{type:"button",onClick:s,style:{background:"#2a2b2c",border:"1px solid #343536",color:"#d7dadc",borderRadius:6,padding:"6px 10px",cursor:"pointer"},children:"Close"})]}),a]})]})}const E=new Set(["sub","author","flair","domain","media"]),A=new Set(["created_desc","score_desc","comments_desc","title_asc"]),R={q:"",sub:[],author:[],flair:[],domain:[],media:[],from:"",to:"",sort:"created_desc",page:1};function S(t=globalThis.location?.search||""){const s={...R},a=new URLSearchParams(t);for(const[o,i]of a.entries())E.has(o)?s[o]=i?i.split(",").filter(Boolean):[]:o==="page"?s.page=Math.max(1,parseInt(i||"1",10)):s[o]=i||"";return A.has(s.sort)||(s.sort="created_desc"),s}function I(t){const s=new URLSearchParams;t.q&&s.set("q",t.q);for(const o of E)t[o]?.length&&s.set(o,t[o].join(","));t.from&&s.set("from",t.from),t.to&&s.set("to",t.to),t.sort&&t.sort!=="created_desc"&&s.set("sort",t.sort),t.page&&t.page!==1&&s.set("page",String(t.page));const a=s.toString();return a?`?${a}`:""}function P(t,s=!1){const a=I(t),o=`${location.pathname}${a}`;s?history.replaceState(null,"",o):history.pushState(null,"",o)}function Q(t,s){let a=t.slice();const o=(n,c)=>!c?.length||n&&c.includes(n),i=n=>n?Math.floor(new Date(n).getTime()/1e3):null;a=a.filter(n=>o(n.subreddit,s.sub)&&o(n.author,s.author)&&o(n.flair,s.flair)&&o(n.link_domain,s.domain)&&o(n.media_type,s.media));const p=i(s.from),l=i(s.to);p&&(a=a.filter(n=>(n.created_utc??0)>=p)),l&&(a=a.filter(n=>(n.created_utc??0)<=l));const m=(s.q||"").trim().toLowerCase();switch(m&&(a=a.filter(n=>(n.title||"").toLowerCase().includes(m)||(n.selftext_preview||"").toLowerCase().includes(m))),s.sort||"created_desc"){case"created_asc":a.sort((n,c)=>(n.created_utc??0)-(c.created_utc??0));break;case"created_desc":default:a.sort((n,c)=>(c.created_utc??0)-(n.created_utc??0));break;case"score_desc":a.sort((n,c)=>(c.score??0)-(n.score??0));break;case"score_asc":a.sort((n,c)=>(n.score??0)-(c.score??0));break;case"comments_desc":a.sort((n,c)=>(c.num_comments??0)-(n.num_comments??0));break;case"comments_asc":a.sort((n,c)=>(n.num_comments??0)-(c.num_comments??0));break;case"title_asc":a.sort((n,c)=>(n.title||"").localeCompare(c.title||""));break;case"title_desc":a.sort((n,c)=>(c.title||"").localeCompare(n.title||""));break}return a}function C(t){return t?new Date(t*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}function B(t){if(!t)return null;try{const s=t.split("/").filter(Boolean),a=s.findIndex(o=>o==="comments");if(a!==-1&&s[a+1]){const o=s[a+1];return o.startsWith("t3_")?o:`t3_${o}`}}catch{}return null}function $(t,s){if(!s||!t)return t;const a=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=new RegExp(`(${a})`,"gi");return t.split(o).map((i,p)=>o.test(i)?e.jsx("mark",{children:i},p):i)}function W(){const[t,s]=h.useState([]),[a,o]=h.useState(null),[i,p]=h.useState(S()),[l,m]=h.useState(!1);h.useEffect(()=>{fetch(`${g}data/indexes/posts-manifest.json`).then(r=>r.json()).then(s).catch(r=>console.error("Failed to load manifest",r))},[]),h.useEffect(()=>{fetch(`${g}data/indexes/facets.json`).then(r=>r.json()).then(o).catch(r=>console.error("Failed to load facets",r))},[]),h.useEffect(()=>{const r=()=>p(S(location.search));return window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[]);const u=r=>{p(r),P(r)},n=h.useMemo(()=>Q(t,i),[t,i]),c=n.length;return t.length?e.jsxs("div",{className:"feed grid",children:[e.jsx("div",{className:"left",children:a&&e.jsx(y,{facets:a,query:i,onChange:u})}),e.jsxs("div",{className:"right",children:[e.jsx("div",{className:"mobile-bar",children:e.jsx("button",{className:"btn",type:"button",onClick:()=>m(!0),children:"Filters"})}),e.jsxs("div",{className:"resultbar",children:[e.jsxs("span",{children:[c," result",c===1?"":"s"]}),i.q&&e.jsxs("span",{className:"meta",children:[" â€¢ searching â€œ",i.q,"â€"]})]}),(c?n:[]).map(r=>{const x=r.id||B(r.permalink);return x?e.jsxs("article",{className:"post-card",children:[e.jsxs("div",{className:"topline",children:[e.jsxs("a",{className:"subreddit",href:`https://www.reddit.com/r/${r.subreddit}`,target:"_blank",rel:"noreferrer noopener",children:["r/",r.subreddit]}),e.jsx("span",{className:"dot",children:"â€¢"}),e.jsxs("span",{className:"by",children:["Posted by ",e.jsxs("span",{className:"author",children:["u/",r.author]})]}),r.created_utc&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"dot",children:"â€¢"}),e.jsx("time",{dateTime:new Date(r.created_utc*1e3).toISOString(),children:C(r.created_utc)})]})]}),e.jsxs("h2",{className:"title",children:[e.jsx("a",{href:`${g}post/${x}`,children:$(r.title,i.q)}),r.flair&&e.jsx("span",{className:"flair",children:r.flair}),r.media_type&&e.jsx("span",{className:"pill",children:r.media_type})]}),r.media_preview&&e.jsx("a",{href:`${g}post/${x}`,className:"media-wrap",children:e.jsx("img",{src:D(r.media_preview),alt:"",loading:"lazy",width:r.preview_width||void 0,height:r.preview_height||void 0})}),r.selftext_preview&&e.jsx("p",{className:"excerpt",children:$(r.selftext_preview,i.q)}),r.link_domain&&r.url&&e.jsxs("a",{className:"link-card",href:r.url,target:"_blank",rel:"noreferrer noopener",title:r.url,children:[e.jsx("div",{className:"link-domain",children:r.link_domain}),e.jsx("div",{className:"link-cta",children:"Open link â†—"})]}),e.jsxs("div",{className:"bottomline",children:[e.jsxs("span",{className:"score",children:["â–² ",r.score??0]}),e.jsx("span",{className:"dot",children:"â€¢"}),e.jsxs("span",{className:"comments",children:["ðŸ’¬ ",r.num_comments??0]}),e.jsx("span",{className:"spacer"}),r.permalink&&e.jsx("a",{className:"action",href:r.permalink,target:"_blank",rel:"noreferrer noopener",children:"View on Reddit"}),e.jsx("a",{className:"action",href:`${g}post/${x}`,children:"Details"}),r.saved_utc&&e.jsxs("span",{className:"saved",children:["Saved ",C(r.saved_utc)]})]})]},x):null}),!c&&e.jsx("div",{className:"empty",children:"No results. Try clearing filters."})]}),e.jsx(z,{open:l,onClose:()=>m(!1),children:a&&e.jsx(y,{facets:a,query:i,onChange:u})})]}):e.jsx("div",{className:"feed loading",children:"Loadingâ€¦"})}export{W as default};
